(()=>{"use strict";var e={63:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidNameError=void 0;class o extends Error{constructor(e){super(`O nome "${e}" é inválido. Deve ter entre 3 e 100 caracteres.`),this.name="InvalidNameError"}}t.InvalidNameError=o},198:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateVectorConfigUseCase=void 0;const n=o(3563),s=o(8516);let c=class{constructor(e){this.chatbotRepository=e}async execute(e,t,o){const i=await this.chatbotRepository.findById(t);if(!i)throw new n.NotFoundException(`Chatbot with ID ${t} not found`);if(i.userId.toString()!==e)throw new n.NotFoundException(`Chatbot with ID ${t} not found`);const r=await this.chatbotRepository.updateVectorConfig(t,{...o,updatedAt:new Date});return this.mapToResponseDto(r)}mapToResponseDto(e){return{id:e.id,name:e.name,description:e.description,systemPrompt:e.systemPrompt,aiModel:e.aiModel,contentWindowSize:e.contentWindowSize,n8nId:e.n8nId,n8nWorkflowId:e.n8nWorkflowId,n8nChatUrl:e.n8nChatUrl,n8nChatRequireButtonClicktoStart:e.n8nChatRequireButtonClicktoStart,n8nChatTitle:e.n8nChatTitle,n8nChatSubtitle:e.n8nChatSubtitle,n8nChatInitialMessage:e.n8nChatInitialMessage,dataVector:e.dataVector,dataVectorSize:e.dataVectorSize,dataVectorIndex:e.dataVectorIndex,dataVectorNamespace:e.dataVectorNamespace,dataVectorModel:e.dataVectorModel,dataVectorEmbeddingsModel:e.dataVectorEmbeddingsModel,isActive:e.isActive,userId:e.userId.toString(),createdAt:e.createdAt,updatedAt:e.updatedAt}}};t.UpdateVectorConfigUseCase=c,t.UpdateVectorConfigUseCase=c=i([(0,n.Injectable)(),a(0,(0,n.Inject)(s.CHATBOT_REPOSITORY)),r("design:paramtypes",[Object])],c)},252:e=>{e.exports=require("minio")},287:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ListUsersUseCase=void 0;const n=o(3563);let s=class{constructor(e){this.userRepository=e}async execute(){return this.userRepository.list()}};t.ListUsersUseCase=s,t.ListUsersUseCase=s=i([(0,n.Injectable)(),a(0,(0,n.Inject)("IUserRepository")),r("design:paramtypes",[Object])],s)},308:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.HelloRepositoryImpl=void 0;const r=o(3563);let a=class{async findById(e){throw new Error("Method not implemented.")}async findAll(){throw new Error("Method not implemented.")}async create(e){throw new Error("Method not implemented.")}async update(e,t){throw new Error("Method not implemented.")}async delete(e){throw new Error("Method not implemented.")}};t.HelloRepositoryImpl=a,t.HelloRepositoryImpl=a=i([(0,r.Injectable)()],a)},330:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DeleteFileUseCase=void 0;const s=o(3563),c=o(8088);let d=i=class{constructor(e,t){this.storageService=e,this.bucketFileRepository=t,this.logger=new s.Logger(i.name)}async execute(e,t){this.logger.log(`Starting file deletion process for file ${e}`);const o=await this.bucketFileRepository.findById(e);if(!o)throw new s.NotFoundException(`File with id ${e} not found`);if(o.userId.toString()!==t)throw new s.NotFoundException(`File with id ${e} not found`);try{await this.storageService.deleteFile(o.fileName),this.logger.log(`File ${o.fileName} deleted from MinIO`),await this.bucketFileRepository.delete(e),this.logger.log(`File record ${e} deleted from MongoDB`)}catch(t){throw this.logger.error(`Error deleting file ${e}:`,t),t}this.logger.log(`File ${e} successfully deleted`)}};t.DeleteFileUseCase=d,t.DeleteFileUseCase=d=i=r([(0,s.Injectable)(),n(0,(0,s.Inject)(c.STORAGE_SERVICE)),n(1,(0,s.Inject)(c.BUCKET_FILE_REPOSITORY)),a("design:paramtypes",[Object,Object])],d)},492:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseRepository=void 0,t.BaseRepository=class{constructor(e){this.model=e}async findById(e){return this.model.findById(e).exec()}async findAll(){return this.model.find().exec()}async create(e){return new this.model(e).save()}async update(e,t){return this.model.findByIdAndUpdate(e,t,{new:!0}).exec()}async delete(e){await this.model.findByIdAndDelete(e).exec()}}},531:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.EmailWorker=void 0;const n=o(3563),s=o(3428),c=o(3942),d=o(1572);let l=i=class{constructor(e){this.configService=e,this.logger=new n.Logger(i.name),this.maxRetries=3,this.retryDelay=5e3,this.queueName="email_notifications",this.deadLetterExchange="email_notifications_dlx",this.deadLetterQueue="email_notifications_dlq",this.transporter=d.createTransport({host:this.configService.get("SMTP_HOST"),port:this.configService.get("SMTP_PORT"),secure:!1,requireTLS:!0,tls:{ciphers:"SSLv3",rejectUnauthorized:!1},auth:{user:this.configService.get("SMTP_USER"),pass:this.configService.get("SMTP_PASSWORD")},pool:!0,maxConnections:5,maxMessages:100,rateDelta:1e3,rateLimit:5}),this.logger.log("Email worker initialized with production settings")}async onModuleInit(){await this.connect(),await this.consume()}async onModuleDestroy(){await this.closeConnection()}async connect(){let e=0;for(;e<this.maxRetries;)try{const e=this.configService.get("RABBITMQ_URI")||"amqp://root:pazdeDeus2025@rabbitmq.gwan.com.br:5672";if(!e)throw new Error("RABBITMQ_URI environment variable is not set");const t=await c.connect(e);this.connection=t;const o=await t.createChannel();this.channel=o,await this.channel.assertExchange(this.deadLetterExchange,"direct",{durable:!0}),await this.channel.assertQueue(this.deadLetterQueue,{durable:!0}),await this.channel.bindQueue(this.deadLetterQueue,this.deadLetterExchange,this.queueName);try{const e=await this.channel.checkQueue(this.queueName);this.logger.log(`[EmailWorker] Fila existente encontrada: ${JSON.stringify(e)}`)}catch(e){this.logger.log("[EmailWorker] Fila não existe, criando nova fila..."),await this.channel.assertQueue(this.queueName,{durable:!0,arguments:{"x-message-ttl":864e5,"x-dead-letter-exchange":this.deadLetterExchange,"x-dead-letter-routing-key":this.queueName}})}return await this.channel.prefetch(1),void this.logger.log("[EmailWorker] Conectado ao RabbitMQ com sucesso")}catch(t){if(e++,this.logger.error(`[EmailWorker] Erro ao conectar ao RabbitMQ (tentativa ${e}/${this.maxRetries}):`,t),!(e<this.maxRetries))throw this.logger.error("[EmailWorker] Número máximo de tentativas de conexão atingido"),t;this.logger.log(`[EmailWorker] Tentando reconectar em ${this.retryDelay/1e3} segundos...`),await new Promise((e=>setTimeout(e,this.retryDelay)))}}async consume(){try{this.channel||await this.connect(),await this.channel.consume(this.queueName,(async e=>{if(e)try{const t=JSON.parse(e.content.toString());await this.sendEmail(t),this.channel.ack(e)}catch(t){this.logger.error("[EmailWorker] Erro ao processar mensagem:",t),this.channel.nack(e,!1,!0)}})),this.logger.log("[EmailWorker] Consumidor iniciado com sucesso")}catch(e){this.logger.error("[EmailWorker] Erro ao iniciar consumidor:",e),setTimeout((()=>this.consume()),this.retryDelay)}}async sendEmail(e){let t=0;for(;t<this.maxRetries;)try{const t={from:{name:this.configService.get("SMTP_FROM_NAME","GWAN"),address:this.configService.get("SMTP_FROM_EMAIL","gwan@gwan.com.br")},to:e.to,subject:e.subject,text:e.content,html:e.content.replace(/\n/g,"<br>"),headers:{"X-Priority":"1","X-MSMail-Priority":"High",Importance:"high"}};return await this.transporter.sendMail(t),void this.logger.log(`[EmailWorker] Email enviado com sucesso - Assunto [${e.subject}] para [${e.to}] conteudo[${e.content}] date[${(new Date).toISOString()}]`)}catch(e){if(t++,this.logger.error(`[EmailWorker] Erro ao enviar email (tentativa ${t}/${this.maxRetries}):`,e),!(t<this.maxRetries))throw this.logger.error("[EmailWorker] Número máximo de tentativas de envio atingido"),e;this.logger.log(`[EmailWorker] Tentando reenviar em ${this.retryDelay/1e3} segundos...`),await new Promise((e=>setTimeout(e,this.retryDelay)))}}async closeConnection(){try{if(this.channel&&await this.channel.close(),this.connection){const e=this.connection;await e.close()}this.logger.log("[EmailWorker] Conexões fechadas com sucesso")}catch(e){this.logger.error("[EmailWorker] Erro ao fechar conexões:",e)}}};t.EmailWorker=l,t.EmailWorker=l=i=r([(0,n.Injectable)(),a("design:paramtypes",[s.ConfigService])],l)},540:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.HttpExceptionFilter=void 0;const a=o(3563);let n=i=class{constructor(){this.logger=new a.Logger(i.name)}catch(e,t){const o=t.switchToHttp(),i=o.getResponse(),r=o.getRequest(),a=e.getStatus(),n={statusCode:a,timestamp:(new Date).toISOString(),path:r.url,method:r.method,message:e.message,error:e.name,details:e.getResponse()};this.logger.error(`[${r.method}] ${r.url} - ${a} ${this.getErrorMessage(a,e.message)}`,{request:{method:r.method,url:r.url,headers:this.sanitizeHeaders(r.headers),body:r.body,query:r.query,params:r.params},error:{status:a,message:this.getErrorMessage(a,e.message),type:e.name,details:this.getErrorDetails(e)},timestamp:n.timestamp}),i.status(a).json({success:!1,error:{code:a,message:this.getErrorMessage(a,e.message),details:this.getErrorDetails(e)},timestamp:n.timestamp,path:n.path})}getErrorMessage(e,t){switch(e){case a.HttpStatus.NOT_FOUND:return"Recurso não encontrado";case a.HttpStatus.BAD_REQUEST:return"Requisição inválida";case a.HttpStatus.UNAUTHORIZED:return"Não autorizado";case a.HttpStatus.FORBIDDEN:return"Acesso negado";case a.HttpStatus.INTERNAL_SERVER_ERROR:return"Erro interno do servidor";default:return t||"Ocorreu um erro"}}getErrorDetails(e){const t=e.getResponse();return"object"==typeof t?t:{message:t}}sanitizeHeaders(e){const t={...e};return delete t.authorization,delete t.cookie,t}};t.HttpExceptionFilter=n,t.HttpExceptionFilter=n=i=r([(0,a.Catch)(a.HttpException)],n)},603:e=>{e.exports=require("rxjs/operators")},643:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateChatbotUseCase=t.CHATBOT_REPOSITORY=void 0;const s=o(3563);t.CHATBOT_REPOSITORY="CHATBOT_REPOSITORY";let c=i=class{constructor(e){this.chatbotRepository=e,this.logger=new s.Logger(i.name)}async execute(e,t,o){const i=await this.chatbotRepository.findById(t);if(!i)throw new s.NotFoundException(`Chatbot with ID ${t} not found`);if(i.userId.toString()!==e)throw new s.NotFoundException(`Chatbot with ID ${t} not found`);const r=await this.chatbotRepository.update(t,{...o,updatedAt:new Date});if(!r)throw new s.NotFoundException(`Failed to update chatbot with ID ${t}`);return this.mapToResponseDto(r)}mapToResponseDto(e){return{id:e.id,name:e.name,description:e.description,systemPrompt:e.systemPrompt,aiModel:e.aiModel,contentWindowSize:e.contentWindowSize,n8nId:e.n8nId,n8nWorkflowId:e.n8nWorkflowId,n8nChatUrl:e.n8nChatUrl,n8nChatRequireButtonClicktoStart:e.n8nChatRequireButtonClicktoStart,n8nChatTitle:e.n8nChatTitle,n8nChatSubtitle:e.n8nChatSubtitle,n8nChatInitialMessage:e.n8nChatInitialMessage,dataVector:e.dataVector,dataVectorSize:e.dataVectorSize,dataVectorIndex:e.dataVectorIndex,dataVectorNamespace:e.dataVectorNamespace,dataVectorModel:e.dataVectorModel,dataVectorEmbeddingsModel:e.dataVectorEmbeddingsModel,isActive:e.isActive,userId:e.userId.toString(),createdAt:e.createdAt,updatedAt:e.updatedAt}}};t.UpdateChatbotUseCase=c,t.UpdateChatbotUseCase=c=i=r([(0,s.Injectable)(),n(0,(0,s.Inject)(t.CHATBOT_REPOSITORY)),a("design:paramtypes",[Object])],c)},829:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseEntity=void 0,t.BaseEntity=class{}},1173:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.UserSchema=t.User=void 0;const a=o(5839),n=o(829),s=o(7403),c=o(9742);let d=class extends n.BaseEntity{};t.User=d,i([(0,c.ApiProperty)({description:"Nome do usuário",example:"John Doe",minLength:3,maxLength:100}),(0,a.Prop)({required:!0}),(0,s.IsString)(),r("design:type",String)],d.prototype,"name",void 0),i([(0,c.ApiProperty)({description:"Descrição do usuário",example:"Desenvolvedor Full Stack",required:!1,maxLength:500}),(0,a.Prop)(),(0,s.IsString)(),(0,s.IsOptional)(),r("design:type",String)],d.prototype,"description",void 0),i([(0,c.ApiProperty)({description:"Email do usuário",example:"john@example.com",format:"email"}),(0,a.Prop)({required:!0,unique:!0}),(0,s.IsString)(),r("design:type",String)],d.prototype,"email",void 0),i([(0,c.ApiProperty)({description:"WhatsApp do usuário",example:"5511999999999"}),(0,a.Prop)({required:!0,unique:!0}),(0,s.IsString)(),r("design:type",String)],d.prototype,"whatsapp",void 0),i([(0,c.ApiProperty)({description:"Status de verificação do email",example:!1,default:!1}),(0,a.Prop)({default:!1}),(0,s.IsBoolean)(),r("design:type",Boolean)],d.prototype,"isEmailVerified",void 0),i([(0,c.ApiProperty)({description:"Status de ativação da conta",example:!0,default:!0}),(0,a.Prop)({default:!0}),(0,s.IsBoolean)(),r("design:type",Boolean)],d.prototype,"isActive",void 0),i([(0,c.ApiProperty)({description:"Status de verificação",example:!1,default:!1}),(0,a.Prop)({default:!1}),(0,s.IsBoolean)(),r("design:type",Boolean)],d.prototype,"isVerified",void 0),t.User=d=i([(0,a.Schema)({timestamps:!0})],d),t.UserSchema=a.SchemaFactory.createForClass(d)},1177:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.RabbitMQModule=void 0;const r=o(3563),a=o(6746),n=o(3428);let s=class{};t.RabbitMQModule=s,t.RabbitMQModule=s=i([(0,r.Module)({imports:[n.ConfigModule],providers:[a.RabbitMQService],exports:[a.RabbitMQService]})],s)},1278:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.StartProcessUseCase=void 0;const s=o(3563),c=o(5511),d=o(8375),l=o(8088);let p=i=class{constructor(e,t,o){this.knowledgeBaseRepository=e,this.bucketFileRepository=t,this.rabbitMQService=o,this.logger=new s.Logger(i.name)}async execute(e,t,o){this.logger.log(`Starting process for knowledge base ${e} and file ${o}`);const i=await this.knowledgeBaseRepository.findById(e);if(!i)throw new s.NotFoundException(`Knowledge base with id ${e} not found`);if(i.userId.toString()!==t)throw new s.NotFoundException(`Knowledge base with id ${e} not found`);const r=await this.bucketFileRepository.findById(o);if(!r)throw new s.NotFoundException(`File with id ${o} not found`);if(r.userId.toString()!==t||r.knowledgeBaseId?.toString()!==e)throw new s.NotFoundException(`File with id ${o} not found`);"processing"!==i.status?(await this.knowledgeBaseRepository.update(e,{status:"processing"}),await this.bucketFileRepository.update(o,{status:"processing"}),await this.rabbitMQService.sendMessage({knowledgeBaseId:e,userId:t,bucketFileId:o}),this.logger.log(`Process started for knowledge base ${e} and file ${o}`)):this.logger.warn(`Knowledge base ${e} is already being processed`)}};t.StartProcessUseCase=p,t.StartProcessUseCase=p=i=r([(0,s.Injectable)(),n(0,(0,s.Inject)(d.KNOWLEDGE_BASE_REPOSITORY)),n(1,(0,s.Inject)(l.BUCKET_FILE_REPOSITORY)),a("design:paramtypes",[Object,Object,c.RabbitMQService])],p)},1296:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MongoDBChatbotRepository=void 0;const n=o(3563),s=o(5839),c=o(6037),d=o(4664);let l=class{constructor(e){this.chatbotModel=e}async findAll(){return(await this.chatbotModel.find().exec()).map(this.mapToEntity)}async create(e){const t=new this.chatbotModel(e),o=await t.save();return this.mapToEntity(o)}async findById(e){const t=await this.chatbotModel.findById(e).exec();return t?this.mapToEntity(t):null}async findByUserId(e){return(await this.chatbotModel.find({userId:e}).exec()).map(this.mapToEntity)}async findByName(e){const t=await this.chatbotModel.findOne({name:e}).exec();return t?this.mapToEntity(t):null}async findByN8nId(e){const t=await this.chatbotModel.findOne({n8nId:e}).exec();return t?this.mapToEntity(t):null}async update(e,t){const o=await this.chatbotModel.findByIdAndUpdate(e,t,{new:!0}).exec();return o?this.mapToEntity(o):null}async updateStatus(e,t){const o=await this.chatbotModel.findByIdAndUpdate(e,{isActive:t},{new:!0}).exec();if(!o)throw new Error(`Chatbot with ID ${e} not found`);return this.mapToEntity(o)}async updateN8nConfig(e,t){const o=await this.chatbotModel.findByIdAndUpdate(e,t,{new:!0}).exec();if(!o)throw new Error(`Chatbot with ID ${e} not found`);return this.mapToEntity(o)}async updateVectorConfig(e,t){const o=await this.chatbotModel.findByIdAndUpdate(e,t,{new:!0}).exec();if(!o)throw new Error(`Chatbot with ID ${e} not found`);return this.mapToEntity(o)}async delete(e){await this.chatbotModel.deleteOne({_id:e}).exec()}async list(e,t){const o=(e-1)*t,[i,r]=await Promise.all([this.chatbotModel.find().skip(o).limit(t).exec(),this.chatbotModel.countDocuments().exec()]);return{data:i.map(this.mapToEntity),total:r}}mapToEntity(e){const{_id:t,...o}=e.toObject();return new d.Chatbot({id:t.toString(),...o})}};t.MongoDBChatbotRepository=l,t.MongoDBChatbotRepository=l=i([(0,n.Injectable)(),a(0,(0,s.InjectModel)("Chatbot")),r("design:paramtypes",[c.Model])],l)},1403:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.GetHelloUseCase=void 0;const a=o(3563),n=o(2586),s=o(7176);let c=class extends s.BaseUseCase{constructor(e){super(e),this.helloService=e}async execute(){return this.helloService.getHelloMessage()}};t.GetHelloUseCase=c,t.GetHelloUseCase=c=i([(0,a.Injectable)(),r("design:paramtypes",[n.HelloService])],c)},1454:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.UploadFileDto=void 0;const a=o(7403),n=o(9742);let s=class{};t.UploadFileDto=s,i([(0,n.ApiProperty)({description:"ID da base de conhecimento (opcional)"}),(0,a.IsString)(),(0,a.IsOptional)(),r("design:type",String)],s.prototype,"knowledgeBaseId",void 0),t.UploadFileDto=s=i([(0,n.ApiSchema)({name:"DatasetUploadFileModel"})],s)},1477:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationService=void 0;const n=o(3563),s=o(9e3);let c=i=class{constructor(e){this.rabbitMQService=e,this.logger=new n.Logger(i.name)}async sendEmail(e,t,o){try{this.logger.log(`Preparando envio de email para: ${e}`);const i={to:e,subject:t,content:o,timestamp:(new Date).toISOString()};this.logger.log(`Enviando mensagem para fila email_notifications: ${JSON.stringify(i)}`),await this.rabbitMQService.sendToQueue("email_notifications",i),this.logger.log("Mensagem enviada com sucesso para fila email_notifications")}catch(t){throw this.logger.error(`Erro ao enviar email para ${e}:`,t),t}}async sendWhatsApp(e,t){try{this.logger.log(`Preparando envio de WhatsApp para: ${e}`);const o={to:e,message:t,timestamp:(new Date).toISOString()};this.logger.log(`Enviando mensagem para fila whatsapp_notifications: ${JSON.stringify(o)}`),await this.rabbitMQService.sendToQueue("whatsapp_notifications",o),this.logger.log("Mensagem enviada com sucesso para fila whatsapp_notifications")}catch(t){throw this.logger.error(`Erro ao enviar WhatsApp para ${e}:`,t),t}}};t.NotificationService=c,t.NotificationService=c=i=r([(0,n.Injectable)(),a("design:paramtypes",[s.RabbitMQService])],c)},1572:e=>{e.exports=require("nodemailer")},1697:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.LoggingInterceptor=void 0;const a=o(3563),n=o(603);let s=i=class{constructor(){this.logger=new a.Logger(i.name)}intercept(e,t){const o=e.switchToHttp().getRequest(),{method:i,url:r,body:a}=o,s=Date.now();return t.handle().pipe((0,n.tap)({next:t=>{const o=e.switchToHttp().getResponse(),a=Date.now()-s;this.logger.log(`${i} ${r} ${o.statusCode} ${a}ms`)},error:e=>{const t=Date.now()-s;this.logger.error(`${i} ${r} ${e.status} ${t}ms`,e.stack)}}))}};t.LoggingInterceptor=s,t.LoggingInterceptor=s=i=r([(0,a.Injectable)()],s)},1762:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProfileController=void 0;const n=o(3563),s=o(9742),c=o(6291),d=o(2970),l=o(3305),p=o(4936);let u=class{constructor(e,t){this.updateProfileUseCase=e,this.getUserProfileUseCase=t}async getProfile(e){return this.getUserProfileUseCase.execute(e.user.id)}async updateProfile(e,t){return this.updateProfileUseCase.execute(e.user.id,t)}};t.ProfileController=u,i([(0,n.Get)(),(0,n.UseGuards)(c.JwtAuthGuard),(0,s.ApiBearerAuth)(),(0,s.ApiOperation)({summary:"Obter perfil do usuário",description:"Retorna os dados do perfil do usuário autenticado"}),(0,s.ApiResponse)({status:200,description:"Perfil obtido com sucesso",type:p.UserProfileResponseDto}),(0,s.ApiResponse)({status:401,description:"Não autorizado - Token JWT inválido ou ausente"}),(0,s.ApiResponse)({status:404,description:"Usuário não encontrado"}),a(0,(0,n.Request)()),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],u.prototype,"getProfile",null),i([(0,n.Put)(),(0,n.UseGuards)(c.JwtAuthGuard),(0,s.ApiBearerAuth)(),(0,s.ApiOperation)({summary:"Atualizar perfil do usuário",description:"Atualiza o nome e/ou WhatsApp do perfil do usuário autenticado"}),(0,s.ApiBody)({type:p.UserUpdateProfileDto,description:"Dados para atualização do perfil",examples:{example1:{value:{name:"João da Silva",whatsapp:"+5511999999999"},summary:"Atualização completa"},example2:{value:{name:"João da Silva"},summary:"Atualização apenas do nome"},example3:{value:{whatsapp:"+5511999999999"},summary:"Atualização apenas do WhatsApp"}}}),(0,s.ApiResponse)({status:200,description:"Perfil atualizado com sucesso",type:p.UserProfileResponseDto}),(0,s.ApiResponse)({status:400,description:"Dados inválidos - Verifique os campos obrigatórios e suas restrições"}),(0,s.ApiResponse)({status:401,description:"Não autorizado - Token JWT inválido ou ausente"}),(0,s.ApiResponse)({status:404,description:"Usuário não encontrado"}),a(0,(0,n.Request)()),a(1,(0,n.Body)()),r("design:type",Function),r("design:paramtypes",[Object,p.UserUpdateProfileDto]),r("design:returntype",Promise)],u.prototype,"updateProfile",null),t.ProfileController=u=i([(0,s.ApiTags)("profile"),(0,n.Controller)("profile"),r("design:paramtypes",[d.UpdateProfileUseCase,l.GetUserProfileUseCase])],u)},1769:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HELLO_REPOSITORY=void 0,t.HELLO_REPOSITORY="HELLO_REPOSITORY"},1894:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DomainKnowledgeService=void 0;const n=o(3563),s=o(8916),c=o(8375);let d=class{constructor(e){this.knowledgeRepository=e}async findByAuthorId(e){return(await this.knowledgeRepository.findByAuthorId(e)).map(s.KnowledgeMapper.toResponseDto)}async findByCategory(e){return(await this.knowledgeRepository.findByCategory(e)).map(s.KnowledgeMapper.toResponseDto)}async findByTags(e){return(await this.knowledgeRepository.findByTags(e)).map(s.KnowledgeMapper.toResponseDto)}async findById(e){const t=await this.knowledgeRepository.findById(e);if(!t)throw new n.NotFoundException(`Knowledge with ID ${e} not found`);return s.KnowledgeMapper.toResponseDto(t)}async findAll(){return(await this.knowledgeRepository.findAll()).map(s.KnowledgeMapper.toResponseDto)}async create(e){const t=await this.knowledgeRepository.create(e);return s.KnowledgeMapper.toResponseDto(t)}async update(e,t){const o=await this.knowledgeRepository.update(e,t);if(!o)throw new n.NotFoundException(`Knowledge with ID ${e} not found`);return s.KnowledgeMapper.toResponseDto(o)}async delete(e){if(!await this.knowledgeRepository.findById(e))throw new n.NotFoundException(`Knowledge with ID ${e} not found`);await this.knowledgeRepository.delete(e)}};t.DomainKnowledgeService=d,t.DomainKnowledgeService=d=i([(0,n.Injectable)(),a(0,(0,n.Inject)(c.KNOWLEDGE_REPOSITORY)),r("design:paramtypes",[Object])],d)},1902:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.KnowledgeRepository=void 0;const n=o(3563),s=o(5839),c=o(6037),d=o(492),l=o(2983);let p=class extends d.BaseRepository{constructor(e){super(e),this.knowledgeModel=e}async findByAuthorId(e){return this.knowledgeModel.find({authorId:e}).exec()}async findByCategory(e){return this.knowledgeModel.find({category:e}).exec()}async findByTags(e){return this.knowledgeModel.find({tags:{$in:e}}).exec()}};t.KnowledgeRepository=p,t.KnowledgeRepository=p=i([(0,n.Injectable)(),a(0,(0,s.InjectModel)(l.Knowledge.name)),r("design:paramtypes",[c.Model])],p)},1960:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Email=void 0;const i=o(4977),r=o(9598);class a extends i.ValueObject{constructor(e){super(e)}static create(e){if(!this.isValid(e))throw new r.InvalidEmailError(e);return new a(this.normalize(e))}static isValid(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}static normalize(e){return e.toLowerCase().trim()}getValue(){return this._value}equals(e){return this._value===e._value}toString(){return this._value}}t.Email=a},2126:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ListFilesUseCase=void 0;const s=o(3563),c=o(8088),d=o(8205),l=o(6037);let p=i=class{constructor(e,t){this.storageService=e,this.bucketFileRepository=t,this.logger=new s.Logger(i.name)}async execute(e){this.logger.debug(`[ListFiles] Sincronizando arquivos do usuário: ${e}`);const t=await this.bucketFileRepository.findByUserId(e),o=`${e}/`,i=await this.storageService.listFiles(o),r=new Map(i.map((e=>[e.name,e]))),a=new Map(t.map((e=>[e.fileName,e]))),n=[],s=[];for(const[e,t]of a)r.has(e)||(s.push(t.id),this.logger.debug(`[ListFiles] Arquivo ${e} existe no MongoDB mas não no MinIO. Marcado para remoção.`));for(const[t,o]of r){const i=a.get(t),r=await this.storageService.getFileUrl(t);i?i.size===o.size&&i.lastModified===o.lastModified&&i.url===r||(n.push({...i,size:o.size,lastModified:o.lastModified,url:r,status:"error"===i.status?"available":i.status}),this.logger.debug(`[ListFiles] Arquivo ${t} precisa ser atualizado no MongoDB.`)):(n.push({userId:new l.Types.ObjectId(e),fileName:t,originalName:t.split("/").pop()||t,mimeType:o.mimeType||"application/octet-stream",size:o.size,url:r,bucketName:"datasets",status:"available",lastModified:o.lastModified}),this.logger.debug(`[ListFiles] Arquivo ${t} existe no MinIO mas não no MongoDB. Marcado para criação.`))}s.length>0&&(await this.bucketFileRepository.deleteMany(s),this.logger.debug(`[ListFiles] Removidos ${s.length} arquivos do MongoDB.`)),n.length>0&&(await this.bucketFileRepository.updateMany(n),this.logger.debug(`[ListFiles] Atualizados ${n.length} arquivos no MongoDB.`));const c=await this.bucketFileRepository.findByUserIdAndStatus(e,d.FileStatus.AVAILABLE),p=await this.bucketFileRepository.findByUserIdAndStatus(e,d.FileStatus.PROCESSING),u=await this.bucketFileRepository.findByUserIdAndStatus(e,d.FileStatus.PROCESSED),g=await this.bucketFileRepository.findByUserIdAndStatus(e,d.FileStatus.ERROR),f=[...c,...p,...u,...g].map((e=>{const t=r.get(e.fileName);return t?{id:e.id,name:e.fileName,size:e.size,lastModified:e.lastModified,etag:t.etag,originalName:e.originalName,mimeType:e.mimeType,url:e.url,status:e.status,processingError:e.processingError}:null})).filter(Boolean);return this.logger.debug(`[ListFiles] Sincronização concluída. Total de arquivos: ${f.length}`),this.logger.debug(`[ListFiles] Status: ${c.length} disponíveis, ${p.length} em processamento, ${u.length} processados, ${g.length} com erro`),f}};t.ListFilesUseCase=p,t.ListFilesUseCase=p=i=r([(0,s.Injectable)(),n(0,(0,s.Inject)(c.STORAGE_SERVICE)),n(1,(0,s.Inject)(c.BUCKET_FILE_REPOSITORY)),a("design:paramtypes",[Object,Object])],p)},2187:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.ProfileModule=void 0;const r=o(3563),a=o(5839),n=o(1762),s=o(2970),c=o(3305),d=o(5971),l=o(1173),p=o(9609),u=o(9129);let g=class{};t.ProfileModule=g,t.ProfileModule=g=i([(0,r.Module)({imports:[a.MongooseModule.forFeature([{name:l.User.name,schema:l.UserSchema}]),u.AuthModule],controllers:[n.ProfileController],providers:[s.UpdateProfileUseCase,c.GetUserProfileUseCase,{provide:p.USER_REPOSITORY,useClass:d.UserRepository}],exports:[p.USER_REPOSITORY]})],g)},2513:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ListChatbotsUseCase=void 0;const n=o(3563),s=o(8516);let c=class{constructor(e){this.chatbotRepository=e}async execute(e,t=1,o=10){const{data:i,total:r}=await this.chatbotRepository.list(t,o);return{data:i.map(this.mapToResponseDto),total:r,page:t,limit:o}}mapToResponseDto(e){return{id:e.id,name:e.name,description:e.description,systemPrompt:e.systemPrompt,aiModel:e.aiModel,contentWindowSize:e.contentWindowSize,n8nId:e.n8nId,n8nWorkflowId:e.n8nWorkflowId,n8nChatUrl:e.n8nChatUrl,n8nChatRequireButtonClicktoStart:e.n8nChatRequireButtonClicktoStart,n8nChatTitle:e.n8nChatTitle,n8nChatSubtitle:e.n8nChatSubtitle,n8nChatInitialMessage:e.n8nChatInitialMessage,dataVector:e.dataVector,dataVectorSize:e.dataVectorSize,dataVectorIndex:e.dataVectorIndex,dataVectorNamespace:e.dataVectorNamespace,dataVectorModel:e.dataVectorModel,dataVectorEmbeddingsModel:e.dataVectorEmbeddingsModel,isActive:e.isActive,userId:e.userId.toString(),createdAt:e.createdAt,updatedAt:e.updatedAt}}};t.ListChatbotsUseCase=c,t.ListChatbotsUseCase=c=i([(0,n.Injectable)(),a(0,(0,n.Inject)(s.CHATBOT_REPOSITORY)),r("design:paramtypes",[Object])],c)},2586:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.HelloService=void 0;const n=o(3563),s=o(8254),c=o(1769);let d=class extends s.BaseService{constructor(e){super(e),this.repository=e}async getHelloMessage(){return"Hello World!"}};t.HelloService=d,t.HelloService=d=i([(0,n.Injectable)(),a(0,(0,n.Inject)(c.HELLO_REPOSITORY)),r("design:paramtypes",[Object])],d)},2649:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserService=void 0;const s=o(3563),c=o(8254),d=o(4729),l=o(1960);let p=i=class extends c.BaseService{constructor(e){super(e),this.userRepository=e,this.logger=new s.Logger(i.name)}async findByEmail(e){const t=l.Email.create(e).getValue();return this.logger.debug(`[FindByEmail] Buscando usuário por email: ${t}`),this.userRepository.findByEmail(t)}async findByWhatsApp(e){return this.logger.debug(`[FindByWhatsApp] Buscando usuário por WhatsApp: ${e}`),this.userRepository.findByWhatsApp(e)}async findByVerificationCode(e){return this.logger.debug(`[FindByVerificationCode] Buscando usuário por código: ${e}`),this.userRepository.findByVerificationCode(e)}async updateVerificationStatus(e,t){return this.logger.debug(`[UpdateVerificationStatus] Atualizando status de verificação: ${e}`),await this.userRepository.updateVerificationStatus(e,t),this.userRepository.findById(e)}async updateVerificationCode(e,t,o){return this.logger.debug(`[UpdateVerificationCode] Atualizando código de verificação: ${e}`),await this.userRepository.updateVerificationCode(e,t,o),this.userRepository.findById(e)}async updateLoginCode(e,t,o){return this.logger.debug(`[UpdateLoginCode] Atualizando código de login: ${e}`),await this.userRepository.updateLoginCode(e,t,o),this.userRepository.findById(e)}async clearLoginCode(e){return this.logger.debug(`[ClearLoginCode] Limpando código de login: ${e}`),await this.userRepository.clearLoginCode(e),this.userRepository.findById(e)}async updateActivationCode(e,t,o){return this.logger.debug(`[UpdateActivationCode] Atualizando código de ativação: ${e}`),await this.userRepository.updateActivationCode(e,t,o),this.userRepository.findById(e)}async clearActivationCode(e){return this.logger.debug(`[ClearActivationCode] Limpando código de ativação: ${e}`),await this.userRepository.clearActivationCode(e),this.userRepository.findById(e)}async verifyUser(e){return this.logger.debug(`[VerifyUser] Verificando usuário: ${e}`),await this.userRepository.verifyUser(e),this.userRepository.findById(e)}async updateLastLogin(e){return this.logger.debug(`[UpdateLastLogin] Atualizando último login: ${e}`),await this.userRepository.updateLastLogin(e),this.userRepository.findById(e)}async deleteMany(e){this.logger.debug(`[DeleteMany] Removendo usuários com filtro: ${JSON.stringify(e)}`),await this.userRepository.deleteMany(e)}async updatePassword(e,t){this.logger.debug(`[UpdatePassword] Atualizando senha do usuário: ${e}`);const o=await d.hash(t,10);return await this.userRepository.updatePassword(e,o),this.userRepository.findById(e)}};t.UserService=p,t.UserService=p=i=r([(0,s.Injectable)(),n(0,(0,s.Inject)("IUserRepository")),a("design:paramtypes",[Object])],p)},2714:e=>{e.exports=require("passport-jwt")},2918:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.AppService=void 0;const r=o(3563);let a=class{getHello(){return"Hello World!"}};t.AppService=a,t.AppService=a=i([(0,r.Injectable)()],a)},2970:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateProfileUseCase=void 0;const n=o(3563),s=o(9609);let c=class{constructor(e){this.userRepository=e}async execute(e,t){if(!await this.userRepository.findById(e))throw new n.NotFoundException("Usuário não encontrado");const o=["name","description","whatsapp"],i=Object.keys(t).filter((e=>o.includes(e))).reduce(((e,o)=>(e[o]=t[o],e)),{});if(0===Object.keys(i).length)throw new n.BadRequestException("Nenhum campo válido para atualização");return this.userRepository.updateProfile(e,i)}};t.UpdateProfileUseCase=c,t.UpdateProfileUseCase=c=i([(0,n.Injectable)(),a(0,(0,n.Inject)(s.USER_REPOSITORY)),r("design:paramtypes",[Object])],c)},2983:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.KnowledgeSchema=t.Knowledge=void 0;const a=o(5839),n=o(829);let s=class extends n.BaseEntity{};t.Knowledge=s,i([(0,a.Prop)({required:!0}),r("design:type",String)],s.prototype,"title",void 0),i([(0,a.Prop)({required:!0}),r("design:type",String)],s.prototype,"content",void 0),i([(0,a.Prop)({required:!0}),r("design:type",String)],s.prototype,"category",void 0),i([(0,a.Prop)({type:[String],default:[]}),r("design:type",Array)],s.prototype,"tags",void 0),i([(0,a.Prop)({required:!0}),r("design:type",String)],s.prototype,"authorId",void 0),t.Knowledge=s=i([(0,a.Schema)({timestamps:!0})],s),t.KnowledgeSchema=a.SchemaFactory.createForClass(s)},3088:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.FileUploadResultDto=t.FileListResultDto=void 0;const a=o(9742),n=o(8205);let s=class{};t.FileListResultDto=s,i([(0,a.ApiProperty)({description:"ID do arquivo"}),r("design:type",String)],s.prototype,"id",void 0),i([(0,a.ApiProperty)({description:"Nome do arquivo"}),r("design:type",String)],s.prototype,"name",void 0),i([(0,a.ApiProperty)({description:"Tamanho do arquivo em bytes"}),r("design:type",Number)],s.prototype,"size",void 0),i([(0,a.ApiProperty)({description:"Data da última modificação"}),r("design:type",Date)],s.prototype,"lastModified",void 0),i([(0,a.ApiProperty)({description:"ETag do arquivo"}),r("design:type",String)],s.prototype,"etag",void 0),i([(0,a.ApiProperty)({description:"Nome original do arquivo"}),r("design:type",String)],s.prototype,"originalName",void 0),i([(0,a.ApiProperty)({description:"Tipo MIME do arquivo"}),r("design:type",String)],s.prototype,"mimeType",void 0),i([(0,a.ApiProperty)({description:"URL do arquivo"}),r("design:type",String)],s.prototype,"url",void 0),i([(0,a.ApiProperty)({description:"Status do arquivo",enum:n.FileStatus,enumName:"FileStatus"}),r("design:type",String)],s.prototype,"status",void 0),i([(0,a.ApiProperty)({description:"Mensagem de erro no processamento",required:!1}),r("design:type",String)],s.prototype,"processingError",void 0),t.FileListResultDto=s=i([(0,a.ApiSchema)({name:"DatasetFileListResultModel"})],s);let c=class{};t.FileUploadResultDto=c,i([(0,a.ApiProperty)({description:"ID do arquivo"}),r("design:type",String)],c.prototype,"id",void 0),i([(0,a.ApiProperty)({description:"Nome original do arquivo"}),r("design:type",String)],c.prototype,"originalname",void 0),i([(0,a.ApiProperty)({description:"Nome do arquivo no storage"}),r("design:type",String)],c.prototype,"filename",void 0),i([(0,a.ApiProperty)({description:"Tamanho do arquivo em bytes"}),r("design:type",Number)],c.prototype,"size",void 0),i([(0,a.ApiProperty)({description:"Tipo MIME do arquivo"}),r("design:type",String)],c.prototype,"mimetype",void 0),i([(0,a.ApiProperty)({description:"URL do arquivo"}),r("design:type",String)],c.prototype,"url",void 0),i([(0,a.ApiProperty)({description:"ID da base de conhecimento"}),r("design:type",String)],c.prototype,"knowledgeBaseId",void 0),i([(0,a.ApiProperty)({description:"Status do arquivo",enum:n.FileStatus,enumName:"FileStatus"}),r("design:type",String)],c.prototype,"status",void 0),t.FileUploadResultDto=c=i([(0,a.ApiSchema)({name:"DatasetFileUploadResultModel"})],c)},3139:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.KnowledgeController=void 0;const n=o(3563),s=o(8240),c=o(6291),d=o(9742),l=o(4313);let p=class{constructor(e){this.knowledgeService=e}async createKnowledgeBase(e,t){return this.knowledgeService.createKnowledgeBase(e.user.id,t.name,t.description)}async listKnowledgeBases(e){return this.knowledgeService.listUserKnowledgeBases(e.user.id)}async getKnowledgeBase(e,t){return this.knowledgeService.getKnowledgeBaseById(t,e.user.id)}async deleteKnowledgeBase(e,t){return this.knowledgeService.deleteKnowledgeBase(t,e.user.id)}async startProcess(e,t,o){const i=o.user.id;return this.knowledgeService.startProcess(e,i,t)}};t.KnowledgeController=p,i([(0,n.Post)(),(0,d.ApiOperation)({summary:"Criar uma nova base de conhecimento",description:"Cria uma nova base de conhecimento a partir de um arquivo PDF existente"}),(0,d.ApiResponse)({status:201,description:"Base de conhecimento criada com sucesso",schema:{properties:{_id:{type:"string",example:"507f1f77bcf86cd799439011"},userId:{type:"string",example:"507f1f77bcf86cd799439012"},name:{type:"string",example:"Base de Conhecimento de Marketing"},description:{type:"string",example:"Base de conhecimento contendo informações sobre estratégias de marketing digital"},status:{type:"string",example:"processing",enum:["processing","completed","failed"]},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}}}}),(0,d.ApiResponse)({status:400,description:"Dados inválidos fornecidos"}),(0,d.ApiResponse)({status:401,description:"Não autorizado"}),a(0,(0,n.Request)()),a(1,(0,n.Body)()),r("design:type",Function),r("design:paramtypes",[Object,l.CreateKnowledgeBaseDto]),r("design:returntype",Promise)],p.prototype,"createKnowledgeBase",null),i([(0,n.Get)(),(0,d.ApiOperation)({summary:"Listar bases de conhecimento",description:"Retorna todas as bases de conhecimento do usuário atual"}),(0,d.ApiResponse)({status:200,description:"Lista de bases de conhecimento retornada com sucesso",schema:{type:"array",items:{properties:{_id:{type:"string",example:"507f1f77bcf86cd799439011"},userId:{type:"string",example:"507f1f77bcf86cd799439012"},fileId:{type:"string",example:"507f1f77bcf86cd799439013"},name:{type:"string",example:"Base de Conhecimento de Marketing"},description:{type:"string",example:"Base de conhecimento contendo informações sobre estratégias de marketing digital"},filename:{type:"string",example:"marketing_strategies.pdf"},status:{type:"string",example:"processing",enum:["processing","completed","failed"]},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}}}}}),(0,d.ApiResponse)({status:401,description:"Não autorizado"}),a(0,(0,n.Request)()),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],p.prototype,"listKnowledgeBases",null),i([(0,n.Get)(":id"),(0,d.ApiOperation)({summary:"Obter base de conhecimento específica",description:"Retorna uma base de conhecimento específica pelo ID"}),(0,d.ApiParam)({name:"id",description:"ID da base de conhecimento"}),(0,d.ApiResponse)({status:200,description:"Base de conhecimento retornada com sucesso",schema:{properties:{_id:{type:"string",example:"507f1f77bcf86cd799439011"},userId:{type:"string",example:"507f1f77bcf86cd799439012"},fileId:{type:"string",example:"507f1f77bcf86cd799439013"},name:{type:"string",example:"Base de Conhecimento de Marketing"},description:{type:"string",example:"Base de conhecimento contendo informações sobre estratégias de marketing digital"},filename:{type:"string",example:"marketing_strategies.pdf"},status:{type:"string",example:"processing",enum:["processing","completed","failed"]},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}}}}),(0,d.ApiResponse)({status:401,description:"Não autorizado"}),(0,d.ApiResponse)({status:404,description:"Base de conhecimento não encontrada"}),a(0,(0,n.Request)()),a(1,(0,n.Param)("id")),r("design:type",Function),r("design:paramtypes",[Object,String]),r("design:returntype",Promise)],p.prototype,"getKnowledgeBase",null),i([(0,n.Delete)(":id"),(0,d.ApiOperation)({summary:"Excluir base de conhecimento",description:"Exclui uma base de conhecimento específica pelo ID"}),(0,d.ApiParam)({name:"id",description:"ID da base de conhecimento"}),(0,d.ApiResponse)({status:200,description:"Base de conhecimento excluída com sucesso"}),(0,d.ApiResponse)({status:401,description:"Não autorizado"}),(0,d.ApiResponse)({status:404,description:"Base de conhecimento não encontrada"}),a(0,(0,n.Request)()),a(1,(0,n.Param)("id")),r("design:type",Function),r("design:paramtypes",[Object,String]),r("design:returntype",Promise)],p.prototype,"deleteKnowledgeBase",null),i([(0,n.Post)(":knowledgeBaseId/start-process/:bucketFileId"),(0,d.ApiOperation)({summary:"Iniciar processamento de arquivo",description:"Inicia o processamento de um arquivo específico na base de conhecimento"}),(0,d.ApiParam)({name:"knowledgeBaseId",description:"ID da base de conhecimento"}),(0,d.ApiParam)({name:"bucketFileId",description:"ID do arquivo a ser processado"}),(0,d.ApiResponse)({status:200,description:"Processamento iniciado com sucesso",schema:{properties:{_id:{type:"string",example:"507f1f77bcf86cd799439011"},userId:{type:"string",example:"507f1f77bcf86cd799439012"},name:{type:"string",example:"Base de Conhecimento de Marketing"},description:{type:"string",example:"Base de conhecimento contendo informações sobre marketing"},status:{type:"string",example:"processing",enum:["new","processing","completed","failed"]},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}}}}),(0,d.ApiResponse)({status:400,description:"Base de conhecimento já está em processamento"}),(0,d.ApiResponse)({status:401,description:"Não autorizado"}),(0,d.ApiResponse)({status:404,description:"Base de conhecimento não encontrada"}),a(0,(0,n.Param)("knowledgeBaseId")),a(1,(0,n.Param)("bucketFileId")),a(2,(0,n.Req)()),r("design:type",Function),r("design:paramtypes",[String,String,Object]),r("design:returntype",Promise)],p.prototype,"startProcess",null),t.KnowledgeController=p=i([(0,d.ApiTags)("knowledge"),(0,n.Controller)("user/knowledge"),(0,n.UseGuards)(c.JwtAuthGuard),(0,d.ApiBearerAuth)(),r("design:paramtypes",[s.KnowledgeService])],p)},3205:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.AppModule=void 0;const r=o(3563),a=o(3428),n=o(5839),s=o(6509),c=o(2918),d=o(5755),l=o(9129),p=o(8945),u=o(6717),g=o(8627),f=o(8375),h=o(1177),y=o(3499),m=o(2187),b=o(4845),v=o(8873);let R=class{};t.AppModule=R,t.AppModule=R=i([(0,r.Module)({imports:[a.ConfigModule.forRoot({isGlobal:!0,envFilePath:".env",expandVariables:!0,cache:!0,load:[b.default]}),n.MongooseModule.forRootAsync({imports:[a.ConfigModule],useFactory:e=>({uri:e.get("database.uri")||"mongodb://gwan:pazdeDeus2025@mongodb.gwan.com.br:27017/gwan?authSource=admin"}),inject:[a.ConfigService]}),d.HelloModule,l.AuthModule,p.HealthModule,u.EmailWorkerModule,g.DatasetModule,f.KnowledgeModule,h.RabbitMQModule,y.UsersModule,m.ProfileModule,v.ChatbotsModule],controllers:[s.AppController],providers:[c.AppService]})],R)},3298:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.MinioStorageService=void 0;const n=o(3563),s=o(3428),c=o(252);let d=i=class{constructor(e){this.configService=e,this.logger=new n.Logger(i.name),this.bucketName="datasets";const t={endPoint:this.configService.get("MINIO_ENDPOINT"),port:Number(this.configService.get("MINIO_PORT")),useSSL:"true"===this.configService.get("MINIO_USE_SSL"),accessKey:this.configService.get("MINIO_ACCESS_KEY"),secretKey:this.configService.get("MINIO_SECRET_KEY")};this.logger.log("Initializing MinIO client with config:",{endPoint:t.endPoint,port:t.port,useSSL:t.useSSL,accessKey:t.accessKey,secretKey:t.secretKey}),this.minioClient=new c.Client(t)}async uploadFile(e,t){if(!await this.minioClient.bucketExists(this.bucketName))throw new Error(`Bucket ${this.bucketName} não encontrado`);const o=e.buffer;if(!o)throw new Error("Arquivo inválido ou corrompido");return await this.minioClient.putObject(this.bucketName,t,o,e.size,{"Content-Type":e.mimetype}),t}async listFiles(e){if(!await this.minioClient.bucketExists(this.bucketName))throw new Error(`Bucket ${this.bucketName} não encontrado`);const t=[],o=this.minioClient.listObjects(this.bucketName,e,!0);return new Promise(((e,i)=>{o.on("data",(e=>{t.push({name:e.name,size:e.size,lastModified:e.lastModified,etag:e.etag})})),o.on("end",(()=>{e(t)})),o.on("error",(e=>{this.logger.error("Erro ao listar conteúdo do bucket:",e),i(e)}))}))}async getFileUrl(e,t=86400){return this.minioClient.presignedGetObject(this.bucketName,e,t)}async deleteFile(e){await this.minioClient.removeObject(this.bucketName,e)}};t.MinioStorageService=d,t.MinioStorageService=d=i=r([(0,n.Injectable)(),a("design:paramtypes",[s.ConfigService])],d)},3300:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DatasetController=void 0;const n=o(3563),s=o(9556),c=o(6291),d=o(6484),l=o(2126),p=o(9742),u=o(3868),g=o(3088),f=o(1454);let h=class{constructor(e,t,o){this.uploadFileUseCase=e,this.listFilesUseCase=t,this.datasetService=o}async uploadFile(e,t,o){if(!t.knowledgeBaseId)throw new n.BadRequestException("ID da base de conhecimento é obrigatório");return this.datasetService.uploadFile(e,o.user.id,t.knowledgeBaseId)}async listFiles(e){return(await this.datasetService.listFiles(e.user.id)).map((e=>({id:e.id,name:e.fileName,size:e.size,lastModified:e.createdAt,etag:e.id,originalName:e.originalName,mimeType:e.mimeType,url:e.url,status:e.status,processingError:e.processingError})))}async deleteFile(e,t){return this.datasetService.deleteFile(e,t.user.id)}};t.DatasetController=h,i([(0,n.Post)("upload"),(0,n.UseInterceptors)((0,s.FileInterceptor)("file")),(0,p.ApiConsumes)("multipart/form-data"),(0,p.ApiOperation)({summary:"Upload de arquivo"}),(0,p.ApiBody)({schema:{type:"object",properties:{file:{type:"string",format:"binary",description:"Arquivo para upload"},knowledgeBaseId:{type:"string",description:"ID da base de conhecimento"}}}}),(0,p.ApiResponse)({status:201,description:"Arquivo enviado com sucesso",type:g.FileUploadResultDto}),a(0,(0,n.UploadedFile)()),a(1,(0,n.Body)()),a(2,(0,n.Req)()),r("design:type",Function),r("design:paramtypes",[Object,f.UploadFileDto,Object]),r("design:returntype",Promise)],h.prototype,"uploadFile",null),i([(0,n.Get)("files"),(0,p.ApiOperation)({summary:"Listar arquivos"}),(0,p.ApiResponse)({status:200,description:"Lista de arquivos",type:[g.FileListResultDto]}),a(0,(0,n.Req)()),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],h.prototype,"listFiles",null),i([(0,n.Delete)("files/:id"),(0,p.ApiOperation)({summary:"Excluir arquivo",description:"Remove um arquivo do dataset, excluindo tanto o arquivo do storage quanto o registro do banco de dados"}),(0,p.ApiParam)({name:"id",description:"ID do arquivo a ser removido"}),(0,p.ApiResponse)({status:200,description:"Arquivo excluído com sucesso"}),(0,p.ApiResponse)({status:404,description:"Arquivo não encontrado"}),(0,p.ApiResponse)({status:401,description:"Não autorizado"}),a(0,(0,n.Param)("id")),a(1,(0,n.Req)()),r("design:type",Function),r("design:paramtypes",[String,Object]),r("design:returntype",Promise)],h.prototype,"deleteFile",null),t.DatasetController=h=i([(0,p.ApiTags)("Dataset"),(0,p.ApiBearerAuth)(),(0,n.UseGuards)(c.JwtAuthGuard),(0,n.Controller)("dataset"),r("design:paramtypes",[d.UploadFileUseCase,l.ListFilesUseCase,u.DatasetService])],h)},3305:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.GetUserProfileUseCase=void 0;const n=o(3563),s=o(9609);let c=class{constructor(e){this.userRepository=e}async execute(e){const t=await this.userRepository.findById(e);if(!t)throw new n.NotFoundException("Usuário não encontrado");return t}};t.GetUserProfileUseCase=c,t.GetUserProfileUseCase=c=i([(0,n.Injectable)(),a(0,(0,n.Inject)(s.USER_REPOSITORY)),r("design:paramtypes",[Object])],c)},3428:e=>{e.exports=require("@nestjs/config")},3444:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthController=void 0;const s=o(3563),c=o(5495),d=o(9053),l=o(4813),p=o(7037),u=o(4936),g=o(9742);let f=i=class{constructor(e,t,o,r){this.registerUseCase=e,this.loginUseCase=t,this.verifyCodeUseCase=o,this.verifyLoginCodeUseCase=r,this.logger=new s.Logger(i.name)}async register(e){this.logger.log("[AuthController] Iniciando registro de usuário");const t=await this.registerUseCase.execute({name:e.name,email:e.email,whatsapp:e.whatsapp});return this.logger.log("[AuthController] Registro concluído com sucesso"),{message:"Usuário registrado com sucesso. Verifique seu email e WhatsApp para ativar sua conta.",user:{id:t.id,name:t.name,email:t.email}}}async login(e){this.logger.log("[AuthController] Iniciando processo de login");const t=await this.loginUseCase.execute({email:e.email});return this.logger.log("[AuthController] Código de login enviado com sucesso"),{message:"Código de login enviado com sucesso. Verifique seu email e WhatsApp.",user:{id:t.id,name:t.name,email:t.email}}}async verifyCode(e){this.logger.log("[AuthController] Iniciando verificação de código");const t=await this.verifyCodeUseCase.execute({email:e.email,code:e.code});return this.logger.log("[AuthController] Código verificado com sucesso"),{message:"Usuário verificado com sucesso.",user:{id:t.id,name:t.name,email:t.email}}}async verifyLoginCode(e){return this.logger.log("[AuthController] Iniciando verificação de código de login"),this.verifyLoginCodeUseCase.execute({email:e.email,code:e.code})}};t.AuthController=f,r([(0,s.Post)("register"),(0,g.ApiOperation)({summary:"Registrar um novo usuário"}),(0,g.ApiResponse)({status:201,description:"Usuário registrado com sucesso"}),(0,g.ApiResponse)({status:409,description:"Email ou WhatsApp já cadastrado"}),n(0,(0,s.Body)()),a("design:type",Function),a("design:paramtypes",[u.UserRegisterDto]),a("design:returntype",Promise)],f.prototype,"register",null),r([(0,s.Post)("login"),(0,s.HttpCode)(s.HttpStatus.OK),(0,g.ApiOperation)({summary:"Iniciar processo de login"}),(0,g.ApiResponse)({status:200,description:"Código de login enviado com sucesso"}),(0,g.ApiResponse)({status:404,description:"Usuário não encontrado"}),(0,g.ApiResponse)({status:400,description:"Usuário não verificado"}),n(0,(0,s.Body)()),a("design:type",Function),a("design:paramtypes",[u.UserLoginDto]),a("design:returntype",Promise)],f.prototype,"login",null),r([(0,s.Post)("verify-code"),(0,s.HttpCode)(s.HttpStatus.OK),(0,g.ApiOperation)({summary:"Verificar código de ativação"}),(0,g.ApiResponse)({status:200,description:"Usuário verificado com sucesso"}),(0,g.ApiResponse)({status:404,description:"Usuário não encontrado"}),(0,g.ApiResponse)({status:400,description:"Código inválido ou expirado"}),n(0,(0,s.Body)()),a("design:type",Function),a("design:paramtypes",[u.UserVerifyCodeDto]),a("design:returntype",Promise)],f.prototype,"verifyCode",null),r([(0,s.Post)("verify-login-code"),(0,s.HttpCode)(s.HttpStatus.OK),(0,g.ApiOperation)({summary:"Verificar código de login"}),(0,g.ApiResponse)({status:200,description:"Login realizado com sucesso"}),(0,g.ApiResponse)({status:404,description:"Usuário não encontrado"}),(0,g.ApiResponse)({status:400,description:"Código inválido ou expirado"}),n(0,(0,s.Body)()),a("design:type",Function),a("design:paramtypes",[u.UserVerifyCodeDto]),a("design:returntype",Promise)],f.prototype,"verifyLoginCode",null),t.AuthController=f=i=r([(0,g.ApiTags)("auth"),(0,s.Controller)("auth"),a("design:paramtypes",[c.RegisterUseCase,d.LoginUseCase,l.VerifyCodeUseCase,p.VerifyLoginCodeUseCase])],f)},3499:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.UsersModule=void 0;const r=o(3563),a=o(5839),n=o(4676),s=o(7416),c=o(5231),d=o(287),l=o(7362),p=o(8930),u=o(9129);let g=class{};t.UsersModule=g,t.UsersModule=g=i([(0,r.Module)({imports:[a.MongooseModule.forFeature([{name:"User",schema:p.UserSchemaFactory}]),u.AuthModule],controllers:[n.UsersController],providers:[s.GetUserUseCase,c.UpdateUserUseCase,d.ListUsersUseCase,{provide:"IUserRepository",useClass:l.MongoDBUserRepository}],exports:["IUserRepository"]})],g)},3563:e=>{e.exports=require("@nestjs/common")},3588:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateChatbotUseCase=void 0;const s=o(3563),c=o(6037),d=o(8343),l=o(7176),p=o(8516);let u=i=class extends l.BaseUseCase{constructor(e,t){super(e),this.chatbotService=e,this.chatbotRepository=t,this.logger=new s.Logger(i.name)}async execute(e,t){if(this.logger.debug(`[CreateChatbot] Criando chatbot para usuário: ${e}`),await this.chatbotService.findByName(t.name))throw this.logger.warn(`[CreateChatbot] Já existe um chatbot com o nome: ${t.name}`),new s.ConflictException("Já existe um chatbot com este nome");const o=await this.chatbotService.create({...t,userId:new c.Types.ObjectId(e),isActive:!0});return this.logger.debug(`[CreateChatbot] Chatbot criado com sucesso: ${o.id}`),this.mapToResponseDto(o)}mapToResponseDto(e){return{id:e.id,name:e.name,description:e.description,systemPrompt:e.systemPrompt,aiModel:e.aiModel,contentWindowSize:e.contentWindowSize,n8nId:e.n8nId,n8nWorkflowId:e.n8nWorkflowId,n8nChatUrl:e.n8nChatUrl,n8nChatRequireButtonClicktoStart:e.n8nChatRequireButtonClicktoStart,n8nChatTitle:e.n8nChatTitle,n8nChatSubtitle:e.n8nChatSubtitle,n8nChatInitialMessage:e.n8nChatInitialMessage,dataVector:e.dataVector,dataVectorSize:e.dataVectorSize,dataVectorIndex:e.dataVectorIndex,dataVectorNamespace:e.dataVectorNamespace,dataVectorModel:e.dataVectorModel,dataVectorEmbeddingsModel:e.dataVectorEmbeddingsModel,isActive:e.isActive,userId:e.userId.toString(),createdAt:e.createdAt,updatedAt:e.updatedAt}}};t.CreateChatbotUseCase=u,t.CreateChatbotUseCase=u=i=r([(0,s.Injectable)(),n(1,(0,s.Inject)(p.CHATBOT_REPOSITORY)),a("design:paramtypes",[d.ChatbotService,Object])],u)},3599:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateN8nConfigUseCase=void 0;const n=o(3563),s=o(8516);let c=class{constructor(e){this.chatbotRepository=e}async execute(e,t,o){const i=await this.chatbotRepository.findById(t);if(!i)throw new n.NotFoundException(`Chatbot with ID ${t} not found`);if(i.userId.toString()!==e)throw new n.NotFoundException(`Chatbot with ID ${t} not found`);const r=await this.chatbotRepository.updateN8nConfig(t,{...o,updatedAt:new Date});return this.mapToResponseDto(r)}mapToResponseDto(e){return{id:e.id,name:e.name,description:e.description,systemPrompt:e.systemPrompt,aiModel:e.aiModel,contentWindowSize:e.contentWindowSize,n8nId:e.n8nId,n8nWorkflowId:e.n8nWorkflowId,n8nChatUrl:e.n8nChatUrl,n8nChatRequireButtonClicktoStart:e.n8nChatRequireButtonClicktoStart,n8nChatTitle:e.n8nChatTitle,n8nChatSubtitle:e.n8nChatSubtitle,n8nChatInitialMessage:e.n8nChatInitialMessage,dataVector:e.dataVector,dataVectorSize:e.dataVectorSize,dataVectorIndex:e.dataVectorIndex,dataVectorNamespace:e.dataVectorNamespace,dataVectorModel:e.dataVectorModel,dataVectorEmbeddingsModel:e.dataVectorEmbeddingsModel,isActive:e.isActive,userId:e.userId.toString(),createdAt:e.createdAt,updatedAt:e.updatedAt}}};t.UpdateN8nConfigUseCase=c,t.UpdateN8nConfigUseCase=c=i([(0,n.Injectable)(),a(0,(0,n.Inject)(s.CHATBOT_REPOSITORY)),r("design:paramtypes",[Object])],c)},3868:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DatasetService=void 0;const s=o(3563),c=o(3428),d=o(252),l=o(6037),p=o(8088),u=o(330);let g=i=class{constructor(e,t,o,r){this.configService=e,this.bucketFileRepository=t,this.storageService=o,this.deleteFileUseCase=r,this.logger=new s.Logger(i.name),this.bucketName="datasets";const a={endPoint:this.configService.get("MINIO_ENDPOINT"),port:Number(this.configService.get("MINIO_PORT")),useSSL:"true"===this.configService.get("MINIO_USE_SSL"),accessKey:this.configService.get("MINIO_ACCESS_KEY"),secretKey:this.configService.get("MINIO_SECRET_KEY")};this.logger.log("Initializing MinIO client with config:",{endPoint:a.endPoint,port:a.port,useSSL:a.useSSL,accessKey:a.accessKey,secretKey:a.secretKey}),this.minioClient=new d.Client(a)}async listBucketContents(e){try{if(!await this.minioClient.bucketExists(this.bucketName))throw new s.InternalServerErrorException(`Bucket ${this.bucketName} não encontrado. Por favor, crie o bucket no console do MinIO.`);this.logger.debug("Listando conteúdo do bucket...");const t=await this.bucketFileRepository.findByUserId(e),o=[],i=`${e}/`,r=this.minioClient.listObjects(this.bucketName,i,!0);return new Promise(((i,a)=>{r.on("data",(e=>{const i=t.find((t=>t.fileName===e.name));i&&o.push({id:i.id,name:e.name,size:e.size,lastModified:e.lastModified,etag:e.etag,originalName:i.originalName,mimeType:i.mimeType,url:i.url})})),r.on("end",(()=>{this.logger.debug(`Encontrados ${o.length} objetos no bucket para o usuário ${e}`),i(o)})),r.on("error",(e=>{this.logger.error("Erro ao listar conteúdo do bucket:",{error:e,message:e.message,code:e.code,statusCode:e.statusCode}),a(new s.InternalServerErrorException("Falha ao listar conteúdo do bucket"))}))}))}catch(e){throw this.logger.error("Erro inesperado ao listar conteúdo do bucket:",{error:e,message:e.message,code:e.code,statusCode:e.statusCode}),new s.InternalServerErrorException(e.message||"Ocorreu um erro inesperado ao listar o conteúdo do bucket")}}async uploadFile(e,t,o){if(!o)throw new s.BadRequestException("knowledgeBaseId é obrigatório para upload de arquivos");this.logger.debug(`[UploadFile] Iniciando upload para usuário: ${t} na base de conhecimento: ${o}`);const i=`${t}/${o}/${Date.now()}-${e.originalname}`;await this.storageService.uploadFile(e,i);const r=await this.storageService.getFileUrl(i),a=await this.bucketFileRepository.create({userId:new l.Types.ObjectId(t),originalName:e.originalname,fileName:i,size:e.size,mimeType:e.mimetype,url:r,bucketName:"datasets",knowledgeBaseId:new l.Types.ObjectId(o),status:"available"});return this.logger.debug(`[UploadFile] Upload concluído com sucesso: ${a.id}`),{id:a.id,originalname:e.originalname,filename:i,size:e.size,mimetype:e.mimetype,url:r,knowledgeBaseId:o,status:a.status}}async listFiles(e){return this.logger.debug(`[ListFiles] Listando arquivos do usuário: ${e}`),this.bucketFileRepository.findByUserId(e)}async deleteFile(e,t){return this.deleteFileUseCase.execute(e,t)}};t.DatasetService=g,t.DatasetService=g=i=r([(0,s.Injectable)(),n(1,(0,s.Inject)(p.BUCKET_FILE_REPOSITORY)),n(2,(0,s.Inject)(p.STORAGE_SERVICE)),a("design:paramtypes",[c.ConfigService,Object,Object,u.DeleteFileUseCase])],g)},3942:e=>{e.exports=require("amqplib")},4039:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatbotController=void 0;const n=o(3563),s=o(9742),c=o(6291),d=o(3588),l=o(2513),p=o(643),u=o(5657),g=o(3599),f=o(198),h=o(5598),y=o(6522);let m=class{constructor(e,t,o,i,r,a,n){this.createChatbotUseCase=e,this.listChatbotsUseCase=t,this.updateChatbotUseCase=o,this.deleteChatbotUseCase=i,this.updateN8nConfigUseCase=r,this.updateVectorConfigUseCase=a,this.updateStatusUseCase=n}async create(e,t){return this.createChatbotUseCase.execute(e.user.id,t)}async list(e){return this.listChatbotsUseCase.execute(e.user.id)}async update(e,t,o){return this.updateChatbotUseCase.execute(e.user.id,t,o)}async updateN8nConfig(e,t,o){return this.updateN8nConfigUseCase.execute(e.user.id,t,o)}async updateVectorConfig(e,t,o){return this.updateVectorConfigUseCase.execute(e.user.id,t,o)}async updateStatus(e,t,o){return this.updateStatusUseCase.execute(e.user.id,t,o)}async delete(e,t){return this.deleteChatbotUseCase.execute(e.user.id,t)}};t.ChatbotController=m,i([(0,n.Post)(),(0,s.ApiOperation)({summary:"Criar chatbot"}),(0,s.ApiResponse)({status:201,description:"Chatbot criado com sucesso",type:y.ChatbotResponseDto}),a(0,(0,n.Request)()),a(1,(0,n.Body)()),r("design:type",Function),r("design:paramtypes",[Object,y.CreateChatbotDto]),r("design:returntype",Promise)],m.prototype,"create",null),i([(0,n.Get)(),(0,s.ApiOperation)({summary:"Listar chatbots"}),(0,s.ApiResponse)({status:200,description:"Lista de chatbots retornada com sucesso",type:y.ListChatbotsResponseDto}),a(0,(0,n.Request)()),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],m.prototype,"list",null),i([(0,n.Put)(":id"),(0,s.ApiOperation)({summary:"Atualizar chatbot"}),(0,s.ApiResponse)({status:200,description:"Chatbot atualizado com sucesso",type:y.ChatbotResponseDto}),a(0,(0,n.Request)()),a(1,(0,n.Param)("id")),a(2,(0,n.Body)()),r("design:type",Function),r("design:paramtypes",[Object,String,y.UpdateChatbotRequestDto]),r("design:returntype",Promise)],m.prototype,"update",null),i([(0,n.Put)(":id/n8n-config"),(0,s.ApiOperation)({summary:"Atualizar configuração n8n do chatbot"}),(0,s.ApiResponse)({status:200,description:"Configuração n8n atualizada com sucesso",type:y.ChatbotResponseDto}),a(0,(0,n.Request)()),a(1,(0,n.Param)("id")),a(2,(0,n.Body)()),r("design:type",Function),r("design:paramtypes",[Object,String,y.UpdateN8nConfigDto]),r("design:returntype",Promise)],m.prototype,"updateN8nConfig",null),i([(0,n.Put)(":id/vector-config"),(0,s.ApiOperation)({summary:"Atualizar configuração de vetores do chatbot"}),(0,s.ApiResponse)({status:200,description:"Configuração de vetores atualizada com sucesso",type:y.ChatbotResponseDto}),a(0,(0,n.Request)()),a(1,(0,n.Param)("id")),a(2,(0,n.Body)()),r("design:type",Function),r("design:paramtypes",[Object,String,y.UpdateVectorConfigDto]),r("design:returntype",Promise)],m.prototype,"updateVectorConfig",null),i([(0,n.Put)(":id/status"),(0,s.ApiOperation)({summary:"Atualizar status do chatbot"}),(0,s.ApiResponse)({status:200,description:"Status do chatbot atualizado com sucesso",type:y.ChatbotResponseDto}),a(0,(0,n.Request)()),a(1,(0,n.Param)("id")),a(2,(0,n.Body)()),r("design:type",Function),r("design:paramtypes",[Object,String,y.UpdateChatbotStatusDto]),r("design:returntype",Promise)],m.prototype,"updateStatus",null),i([(0,n.Delete)(":id"),(0,s.ApiOperation)({summary:"Excluir chatbot"}),(0,s.ApiResponse)({status:200,description:"Chatbot excluído com sucesso"}),a(0,(0,n.Request)()),a(1,(0,n.Param)("id")),r("design:type",Function),r("design:paramtypes",[Object,String]),r("design:returntype",Promise)],m.prototype,"delete",null),t.ChatbotController=m=i([(0,s.ApiTags)("Chatbots"),(0,n.Controller)("chatbots"),(0,n.UseGuards)(c.JwtAuthGuard),(0,s.ApiBearerAuth)(),r("design:paramtypes",[d.CreateChatbotUseCase,l.ListChatbotsUseCase,p.UpdateChatbotUseCase,u.DeleteChatbotUseCase,g.UpdateN8nConfigUseCase,f.UpdateVectorConfigUseCase,h.UpdateStatusUseCase])],m)},4313:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateKnowledgeBaseDto=void 0;const a=o(7403),n=o(9742),s=o(9693);let c=class{};t.CreateKnowledgeBaseDto=c,i([(0,a.IsString)(),(0,a.IsNotEmpty)(),r("design:type",String)],c.prototype,"userId",void 0),i([(0,n.ApiProperty)({description:"Nome da base de conhecimento",example:"Base de Conhecimento de Marketing"}),(0,a.IsString)(),(0,a.IsNotEmpty)(),r("design:type",String)],c.prototype,"name",void 0),i([(0,n.ApiProperty)({description:"Descrição da base de conhecimento",example:"Base de conhecimento contendo informações sobre estratégias de marketing digital"}),(0,a.IsString)(),(0,a.IsNotEmpty)(),r("design:type",String)],c.prototype,"description",void 0),i([(0,n.ApiProperty)({description:"Status da base de conhecimento",enum:s.KnowledgeBaseStatus,enumName:"KnowledgeBaseStatus"}),(0,a.IsEnum)(s.KnowledgeBaseStatus),(0,a.IsNotEmpty)(),r("design:type",String)],c.prototype,"status",void 0),t.CreateKnowledgeBaseDto=c=i([(0,n.ApiSchema)({name:"KnowledgeBaseCreateModel"})],c)},4664:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatbotSchema=t.Chatbot=void 0;const a=o(5839),n=o(6037),s=o(829),c=o(9742);let d=class extends s.BaseEntity{constructor(e){super(),Object.assign(this,e)}activate(){this.isActive=!0,this.updatedAt=new Date}deactivate(){this.isActive=!1,this.updatedAt=new Date}updateDetails(e){Object.assign(this,e),this.updatedAt=new Date}};t.Chatbot=d,i([(0,c.ApiProperty)({description:"ID do usuário que criou o chatbot"}),(0,a.Prop)({required:!0,type:n.Types.ObjectId}),r("design:type",n.Types.ObjectId)],d.prototype,"userId",void 0),i([(0,c.ApiProperty)({description:"Nome do chatbot"}),(0,a.Prop)({required:!0}),r("design:type",String)],d.prototype,"name",void 0),i([(0,c.ApiProperty)({description:"Descrição do chatbot"}),(0,a.Prop)({required:!0}),r("design:type",String)],d.prototype,"description",void 0),i([(0,c.ApiProperty)({description:"Prompt do sistema para o chatbot"}),(0,a.Prop)({required:!0}),r("design:type",String)],d.prototype,"systemPrompt",void 0),i([(0,c.ApiProperty)({description:"Modelo de IA utilizado"}),(0,a.Prop)({required:!0}),r("design:type",String)],d.prototype,"aiModel",void 0),i([(0,c.ApiProperty)({description:"Máximo de tokens para respostas da IA",default:2e3}),(0,a.Prop)({default:2e3}),r("design:type",Number)],d.prototype,"maxTokens",void 0),i([(0,c.ApiProperty)({description:"Tamanho da janela de contexto"}),(0,a.Prop)({required:!0,default:12}),r("design:type",Number)],d.prototype,"contentWindowSize",void 0),i([(0,c.ApiProperty)({description:"ID do chatbot no n8n"}),(0,a.Prop)(),r("design:type",String)],d.prototype,"n8nId",void 0),i([(0,c.ApiProperty)({description:"ID do workflow no n8n"}),(0,a.Prop)(),r("design:type",String)],d.prototype,"n8nWorkflowId",void 0),i([(0,c.ApiProperty)({description:"URL do webhook do chat no n8n"}),(0,a.Prop)(),r("design:type",String)],d.prototype,"n8nChatUrl",void 0),i([(0,c.ApiProperty)({description:"Se o chat requer clique no botão para iniciar"}),(0,a.Prop)({default:!0}),r("design:type",Boolean)],d.prototype,"n8nChatRequireButtonClicktoStart",void 0),i([(0,c.ApiProperty)({description:"Título do chat"}),(0,a.Prop)(),r("design:type",String)],d.prototype,"n8nChatTitle",void 0),i([(0,c.ApiProperty)({description:"Subtítulo do chat"}),(0,a.Prop)(),r("design:type",String)],d.prototype,"n8nChatSubtitle",void 0),i([(0,c.ApiProperty)({description:"Mensagem inicial do chat"}),(0,a.Prop)(),r("design:type",String)],d.prototype,"n8nChatInitialMessage",void 0),i([(0,c.ApiProperty)({description:"Nome do vetor de dados"}),(0,a.Prop)(),r("design:type",String)],d.prototype,"dataVector",void 0),i([(0,c.ApiProperty)({description:"Tamanho do vetor de dados"}),(0,a.Prop)(),r("design:type",Number)],d.prototype,"dataVectorSize",void 0),i([(0,c.ApiProperty)({description:"Índice do vetor de dados"}),(0,a.Prop)(),r("design:type",String)],d.prototype,"dataVectorIndex",void 0),i([(0,c.ApiProperty)({description:"Namespace do vetor de dados"}),(0,a.Prop)(),r("design:type",String)],d.prototype,"dataVectorNamespace",void 0),i([(0,c.ApiProperty)({description:"Modelo do vetor de dados"}),(0,a.Prop)(),r("design:type",String)],d.prototype,"dataVectorModel",void 0),i([(0,c.ApiProperty)({description:"Modelo de embeddings do vetor de dados"}),(0,a.Prop)(),r("design:type",String)],d.prototype,"dataVectorEmbeddingsModel",void 0),i([(0,c.ApiProperty)({description:"Status de ativação do chatbot"}),(0,a.Prop)({default:!0}),r("design:type",Boolean)],d.prototype,"isActive",void 0),i([(0,c.ApiProperty)(),r("design:type",Date)],d.prototype,"createdAt",void 0),i([(0,c.ApiProperty)(),r("design:type",Date)],d.prototype,"updatedAt",void 0),t.Chatbot=d=i([(0,a.Schema)({timestamps:!0}),r("design:paramtypes",[Object])],d),t.ChatbotSchema=a.SchemaFactory.createForClass(d)},4676:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UsersController=void 0;const s=o(3563),c=o(7416),d=o(5231),l=o(287),p=o(6291),u=o(9742);let g=i=class{constructor(e,t,o){this.getUserUseCase=e,this.updateUserUseCase=t,this.listUsersUseCase=o,this.logger=new s.Logger(i.name)}async list(){return this.logger.log("[UsersController] Listando usuários"),(await this.listUsersUseCase.execute()).map((e=>e.toJSON()))}async getById(e){return this.logger.log(`[UsersController] Buscando usuário com ID: ${e}`),(await this.getUserUseCase.execute(e)).toJSON()}async update(e,t){return this.logger.log(`[UsersController] Atualizando usuário com ID: ${e}`),(await this.updateUserUseCase.execute({id:e,name:t.name})).toJSON()}};t.UsersController=g,r([(0,s.Get)(),(0,u.ApiOperation)({summary:"Listar todos os usuários"}),(0,u.ApiResponse)({status:200,description:"Lista de usuários retornada com sucesso"}),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],g.prototype,"list",null),r([(0,s.Get)(":id"),(0,u.ApiOperation)({summary:"Obter usuário por ID"}),(0,u.ApiResponse)({status:200,description:"Usuário encontrado com sucesso"}),(0,u.ApiResponse)({status:404,description:"Usuário não encontrado"}),n(0,(0,s.Param)("id")),a("design:type",Function),a("design:paramtypes",[String]),a("design:returntype",Promise)],g.prototype,"getById",null),r([(0,s.Put)(":id"),(0,u.ApiOperation)({summary:"Atualizar usuário"}),(0,u.ApiResponse)({status:200,description:"Usuário atualizado com sucesso"}),(0,u.ApiResponse)({status:404,description:"Usuário não encontrado"}),n(0,(0,s.Param)("id")),n(1,(0,s.Body)()),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],g.prototype,"update",null),t.UsersController=g=i=r([(0,u.ApiTags)("users"),(0,s.Controller)("users"),(0,s.UseGuards)(p.JwtAuthGuard),a("design:paramtypes",[c.GetUserUseCase,d.UpdateUserUseCase,l.ListUsersUseCase])],g)},4729:e=>{e.exports=require("bcryptjs")},4813:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.VerifyCodeUseCase=void 0;const n=o(3563),s=o(2649),c=o(7176),d=o(6815);let l=i=class extends c.BaseUseCase{constructor(e,t){super(e),this.userService=e,this.jwtService=t,this.logger=new n.Logger(i.name)}async execute(e){this.logger.log(`[Verify] Iniciando verificação de código para: ${e.email}`);try{const t=await this.userService.findByEmail(e.email);if(!t)throw this.logger.warn(`[Verify] Usuário não encontrado: ${e.email}`),new n.NotFoundException({message:"Usuário não encontrado",code:"USER_NOT_FOUND",details:{email:e.email}});if(!t.activationCode||!t.activationCodeExpiresAt)throw this.logger.warn(`[Verify] Código de ativação não encontrado para: ${e.email}`),new n.BadRequestException({message:"Código de ativação não encontrado",code:"ACTIVATION_CODE_NOT_FOUND",details:{email:e.email}});if(t.activationCode!==e.code)throw this.logger.warn(`[Verify] Código de ativação inválido para: ${e.email}`),new n.BadRequestException({message:"Código de ativação inválido",code:"INVALID_ACTIVATION_CODE",details:{email:e.email,providedCode:e.code}});if(t.activationCodeExpiresAt<new Date)throw this.logger.warn(`[Verify] Código de ativação expirado para: ${e.email}`),new n.BadRequestException({message:"Código de ativação expirado",code:"ACTIVATION_CODE_EXPIRED",details:{email:e.email,expiresAt:t.activationCodeExpiresAt}});this.logger.log(`[Verify] Verificando usuário: ${t.id}, Email: ${t.email}`);const o=await this.userService.verifyUser(t.id);return this.logger.log(`[Verify] Usuário verificado com sucesso: ${o.id}`),o}catch(e){throw this.logger.error(`[Verify] Erro durante a verificação: ${e.message}`,e.stack),e}}mapToUserResponseDto(e){return{id:e.id,name:e.name,email:e.email,whatsapp:e.whatsapp,isEmailVerified:e.isEmailVerified,isActive:e.isActive,isVerified:e.isVerified,createdAt:e.createdAt,updatedAt:e.updatedAt}}};t.VerifyCodeUseCase=l,t.VerifyCodeUseCase=l=i=r([(0,n.Injectable)(),a("design:paramtypes",[s.UserService,d.JwtService])],l)},4815:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseMongoRepository=void 0,t.BaseMongoRepository=class{constructor(e){this.model=e}async findById(e){return this.model.findById(e).exec()}async findAll(){return this.model.find().exec()}async create(e){return new this.model(e).save()}async update(e,t){return this.model.findByIdAndUpdate(e,{$set:t},{new:!0}).exec()}async delete(e){await this.model.deleteOne({_id:e}).exec()}}},4831:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BucketFileRepositoryImpl=void 0;const s=o(3563),c=o(5839),d=o(6037),l=o(9762);let p=i=class{constructor(e){this.bucketFileModel=e,this.logger=new s.Logger(i.name)}async create(e){const t=new this.bucketFileModel({...e,userId:new d.Types.ObjectId(e.userId),knowledgeBaseId:e.knowledgeBaseId?new d.Types.ObjectId(e.knowledgeBaseId):void 0}),o=await t.save();return this.toInterface(o)}async findById(e){const t=await this.bucketFileModel.findById(e).exec();return t?this.toInterface(t):null}async findByUserId(e){return(await this.bucketFileModel.find({userId:new d.Types.ObjectId(e)}).exec()).map(this.toInterface)}async findByKnowledgeBaseId(e){return(await this.bucketFileModel.find({knowledgeBaseId:new d.Types.ObjectId(e)}).exec()).map(this.toInterface)}async findByStatus(e){return(await this.bucketFileModel.find({status:e}).exec()).map(this.toInterface)}async findByUserIdAndStatus(e,t){return(await this.bucketFileModel.find({userId:new d.Types.ObjectId(e),status:t}).exec()).map(this.toInterface)}async update(e,t){const o=await this.bucketFileModel.findByIdAndUpdate(e,{...t,userId:t.userId?new d.Types.ObjectId(t.userId):void 0,knowledgeBaseId:t.knowledgeBaseId?new d.Types.ObjectId(t.knowledgeBaseId):void 0},{new:!0}).exec();return o?this.toInterface(o):null}async updateMany(e){const t=e.map((e=>{const t={...e,userId:e.userId?new d.Types.ObjectId(e.userId):void 0,knowledgeBaseId:e.knowledgeBaseId?new d.Types.ObjectId(e.knowledgeBaseId):void 0};return e.id?this.bucketFileModel.findByIdAndUpdate(e.id,t,{new:!0}).exec():this.bucketFileModel.create(t)}));await Promise.all(t)}async delete(e){await this.bucketFileModel.findByIdAndDelete(e).exec()}async deleteMany(e){await this.bucketFileModel.deleteMany({_id:{$in:e}}).exec()}toInterface(e){return{id:e._id.toString(),userId:e.userId,originalName:e.originalName,fileName:e.fileName,size:e.size,mimeType:e.mimeType,url:e.url,bucketName:e.bucketName,knowledgeBaseId:e.knowledgeBaseId,status:e.status,processingError:e.processingError,lastModified:e.lastModified,createdAt:e.createdAt,updatedAt:e.updatedAt}}};t.BucketFileRepositoryImpl=p,t.BucketFileRepositoryImpl=p=i=r([(0,s.Injectable)(),n(0,(0,c.InjectModel)(l.BucketFile.name)),a("design:paramtypes",[d.Model])],p)},4845:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=()=>({port:parseInt(process.env.PORT,10)||3e3,database:{uri:process.env.MONGODB_URI||"mongodb://localhost:27017/gwan"},jwt:{secret:process.env.JWT_SECRET||"your-secret-key",expiresIn:process.env.JWT_EXPIRES_IN||"1d"},cors:{origin:["http://localhost:5173","http://localhost:5174","https://bff.gwan.com.br","https://www.bff.gwan.com.br","https://admin.gwan.com.br","https://www.admin.gwan.com.br"],methods:["GET","POST","PUT","DELETE","PATCH","OPTIONS"],allowedHeaders:["Content-Type","Authorization"],credentials:!0},swagger:{title:"GWAN API",description:"API do sistema GWAN",version:"1.0"}})},4936:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.UserAuthResponseDto=t.UserVerifyCodeDto=t.UserLoginDto=t.UserRegisterDto=t.UserUpdateProfileDto=t.UserProfileResponseDto=void 0;const a=o(9742),n=o(7403);let s=class{};t.UserProfileResponseDto=s,i([(0,a.ApiProperty)({description:"ID do usuário"}),r("design:type",String)],s.prototype,"id",void 0),i([(0,a.ApiProperty)({description:"Nome do usuário"}),r("design:type",String)],s.prototype,"name",void 0),i([(0,a.ApiProperty)({description:"Email do usuário"}),r("design:type",String)],s.prototype,"email",void 0),i([(0,a.ApiProperty)({description:"Número do WhatsApp do usuário",required:!1,nullable:!0}),r("design:type",String)],s.prototype,"whatsapp",void 0),i([(0,a.ApiProperty)({description:"Status de verificação do email"}),r("design:type",Boolean)],s.prototype,"isEmailVerified",void 0),i([(0,a.ApiProperty)({description:"Status de ativação da conta"}),r("design:type",Boolean)],s.prototype,"isActive",void 0),i([(0,a.ApiProperty)({description:"Status de verificação"}),r("design:type",Boolean)],s.prototype,"isVerified",void 0),i([(0,a.ApiProperty)({description:"Data de criação do usuário"}),r("design:type",Date)],s.prototype,"createdAt",void 0),i([(0,a.ApiProperty)({description:"Data da última atualização do usuário"}),r("design:type",Date)],s.prototype,"updatedAt",void 0),t.UserProfileResponseDto=s=i([(0,a.ApiSchema)({name:"UserProfileResponseModel"})],s);let c=class{};t.UserUpdateProfileDto=c,i([(0,a.ApiProperty)({description:"Nome do usuário",example:"João da Silva",minLength:3,maxLength:100}),(0,n.IsString)(),(0,n.MinLength)(3,{message:"O nome deve ter no mínimo 3 caracteres"}),(0,n.MaxLength)(100,{message:"O nome deve ter no máximo 100 caracteres"}),r("design:type",String)],c.prototype,"name",void 0),i([(0,a.ApiProperty)({description:"Número do WhatsApp do usuário",example:"+5511999999999",required:!1,pattern:"\\+?[1-9]\\d{1,14}$"}),(0,n.IsString)(),(0,n.IsOptional)(),(0,n.Matches)(/\+?[1-9]\d{1,14}$/,{message:"Formato de WhatsApp inválido. Use o formato internacional (ex: +5511999999999)"}),r("design:type",String)],c.prototype,"whatsapp",void 0),t.UserUpdateProfileDto=c=i([(0,a.ApiSchema)({name:"UserUpdateProfileModel"})],c);let d=class{};t.UserRegisterDto=d,i([(0,a.ApiProperty)({description:"Nome do usuário",example:"João da Silva",minLength:3,maxLength:100}),(0,n.IsString)(),(0,n.MinLength)(3,{message:"O nome deve ter no mínimo 3 caracteres"}),(0,n.MaxLength)(100,{message:"O nome deve ter no máximo 100 caracteres"}),r("design:type",String)],d.prototype,"name",void 0),i([(0,a.ApiProperty)({description:"Email do usuário",example:"joao@example.com"}),(0,n.IsEmail)({},{message:"Email inválido"}),r("design:type",String)],d.prototype,"email",void 0),i([(0,a.ApiProperty)({description:"Número do WhatsApp do usuário",example:"+5511999999999",pattern:"\\+?[1-9]\\d{1,14}$"}),(0,n.IsString)(),(0,n.Matches)(/\+?[1-9]\d{1,14}$/,{message:"Formato de WhatsApp inválido. Use o formato internacional (ex: +5511999999999)"}),r("design:type",String)],d.prototype,"whatsapp",void 0),t.UserRegisterDto=d=i([(0,a.ApiSchema)({name:"UserRegisterModel"})],d);let l=class{};t.UserLoginDto=l,i([(0,a.ApiProperty)({description:"Email do usuário",example:"joao@example.com"}),(0,n.IsEmail)({},{message:"Email inválido"}),r("design:type",String)],l.prototype,"email",void 0),t.UserLoginDto=l=i([(0,a.ApiSchema)({name:"UserLoginModel"})],l);let p=class{};t.UserVerifyCodeDto=p,i([(0,a.ApiProperty)({description:"Código de verificação",example:"123456"}),(0,n.IsString)(),r("design:type",String)],p.prototype,"code",void 0),i([(0,a.ApiProperty)({description:"Email do usuário",example:"joao@example.com"}),(0,n.IsEmail)({},{message:"Email inválido"}),r("design:type",String)],p.prototype,"email",void 0),t.UserVerifyCodeDto=p=i([(0,a.ApiSchema)({name:"UserVerifyCodeModel"})],p);let u=class{};t.UserAuthResponseDto=u,i([(0,a.ApiProperty)({description:"Token JWT de acesso"}),r("design:type",String)],u.prototype,"accessToken",void 0),i([(0,a.ApiProperty)({description:"Dados do usuário autenticado",type:()=>s}),r("design:type",s)],u.prototype,"user",void 0),t.UserAuthResponseDto=u=i([(0,a.ApiSchema)({name:"UserAuthResponseModel"})],u)},4977:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ValueObject=void 0,t.ValueObject=class{constructor(e){this._value=e}get value(){return this._value}toString(){return String(this._value)}}},5194:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatbotSchemaFactory=t.ChatbotSchema=void 0;const a=o(5839),n=o(6037);let s=class extends n.Document{};t.ChatbotSchema=s,i([(0,a.Prop)({required:!0,type:n.Types.ObjectId}),r("design:type",n.Types.ObjectId)],s.prototype,"userId",void 0),i([(0,a.Prop)({required:!0}),r("design:type",String)],s.prototype,"name",void 0),i([(0,a.Prop)({required:!0}),r("design:type",String)],s.prototype,"description",void 0),i([(0,a.Prop)({required:!0}),r("design:type",String)],s.prototype,"systemPrompt",void 0),i([(0,a.Prop)({required:!0}),r("design:type",String)],s.prototype,"aiModel",void 0),i([(0,a.Prop)({default:2e3}),r("design:type",Number)],s.prototype,"maxTokens",void 0),i([(0,a.Prop)({required:!0,default:12}),r("design:type",Number)],s.prototype,"contentWindowSize",void 0),i([(0,a.Prop)(),r("design:type",String)],s.prototype,"n8nId",void 0),i([(0,a.Prop)(),r("design:type",String)],s.prototype,"n8nWorkflowId",void 0),i([(0,a.Prop)(),r("design:type",String)],s.prototype,"n8nChatUrl",void 0),i([(0,a.Prop)({default:!0}),r("design:type",Boolean)],s.prototype,"n8nChatRequireButtonClicktoStart",void 0),i([(0,a.Prop)(),r("design:type",String)],s.prototype,"n8nChatTitle",void 0),i([(0,a.Prop)(),r("design:type",String)],s.prototype,"n8nChatSubtitle",void 0),i([(0,a.Prop)(),r("design:type",String)],s.prototype,"n8nChatInitialMessage",void 0),i([(0,a.Prop)(),r("design:type",String)],s.prototype,"dataVector",void 0),i([(0,a.Prop)(),r("design:type",Number)],s.prototype,"dataVectorSize",void 0),i([(0,a.Prop)(),r("design:type",String)],s.prototype,"dataVectorIndex",void 0),i([(0,a.Prop)(),r("design:type",String)],s.prototype,"dataVectorNamespace",void 0),i([(0,a.Prop)(),r("design:type",String)],s.prototype,"dataVectorModel",void 0),i([(0,a.Prop)(),r("design:type",String)],s.prototype,"dataVectorEmbeddingsModel",void 0),i([(0,a.Prop)({default:!0}),r("design:type",Boolean)],s.prototype,"isActive",void 0),i([(0,a.Prop)(),r("design:type",Date)],s.prototype,"createdAt",void 0),i([(0,a.Prop)(),r("design:type",Date)],s.prototype,"updatedAt",void 0),t.ChatbotSchema=s=i([(0,a.Schema)({timestamps:!0})],s),t.ChatbotSchemaFactory=a.SchemaFactory.createForClass(s)},5231:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateUserUseCase=void 0;const n=o(3563),s=o(6320);let c=class{constructor(e){this.userRepository=e}async execute(e){const t=await this.userRepository.findById(e.id);if(!t)throw new s.UserNotFoundError(e.id);return e.name&&t.updateName(e.name),this.userRepository.update(t)}};t.UpdateUserUseCase=c,t.UpdateUserUseCase=c=i([(0,n.Injectable)(),a(0,(0,n.Inject)("IUserRepository")),r("design:paramtypes",[Object])],c)},5450:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.KnowledgeBaseRepository=void 0;const n=o(3563),s=o(5839),c=o(6037),d=o(492),l=o(8905);let p=class extends d.BaseRepository{constructor(e){super(e),this.knowledgeBaseModel=e}async findByUserId(e){return this.knowledgeBaseModel.find({userId:e}).exec()}async findByIdAndUserId(e,t){return this.knowledgeBaseModel.findOne({_id:e,userId:t}).exec()}async updateStatus(e,t,o){const i={status:t};return o&&(i.error=o),this.knowledgeBaseModel.findByIdAndUpdate(e,i,{new:!0}).exec()}};t.KnowledgeBaseRepository=p,t.KnowledgeBaseRepository=p=i([(0,n.Injectable)(),a(0,(0,s.InjectModel)(l.KnowledgeBase.name)),r("design:paramtypes",[c.Model])],p)},5495:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.RegisterUseCase=void 0;const n=o(3563),s=o(2649),c=o(1477),d=o(7176);let l=i=class extends d.BaseUseCase{constructor(e,t){super(e),this.userService=e,this.notificationService=t,this.logger=new n.Logger(i.name)}async execute(e){this.logger.log(`[Register] Iniciando fluxo de registro para usuário: ${e.email}`),this.logger.debug(`[Register] Dados de registro recebidos: ${JSON.stringify({name:e.name,email:e.email,whatsapp:e.whatsapp})}`);try{if(this.logger.debug(`[Register] Verificando se email já está em uso: ${e.email}`),await this.userService.findByEmail(e.email))throw this.logger.warn(`[Register] Tentativa de registro com email já existente: ${e.email}`),new n.ConflictException({message:"Email já está em uso",code:"EMAIL_ALREADY_EXISTS",details:{email:e.email}});if(this.logger.debug(`[Register] Email disponível para uso: ${e.email}`),this.logger.debug(`[Register] Verificando se WhatsApp já está em uso: ${e.whatsapp}`),await this.userService.findByWhatsApp(e.whatsapp))throw this.logger.warn(`[Register] Tentativa de registro com WhatsApp já existente: ${e.whatsapp}`),new n.ConflictException({message:"WhatsApp já está em uso",code:"WHATSAPP_ALREADY_EXISTS",details:{whatsapp:e.whatsapp}});this.logger.debug(`[Register] WhatsApp disponível para uso: ${e.whatsapp}`),this.logger.log(`[Register] Criando novo usuário no banco de dados: ${e.email}`);const t=await this.userService.create({...e,isActive:!0,isVerified:!1});this.logger.log(`[Register] Usuário criado com sucesso. ID: ${t.id}, Email: ${t.email}`);const o=Math.floor(1e5+9e5*Math.random()).toString(),i=new Date;i.setMinutes(i.getMinutes()+10),this.logger.debug(`[Register] Gerando código de verificação para usuário: ${t.id}`),await this.userService.updateActivationCode(t.id,o,i),this.logger.debug(`[Register] Código de verificação gerado e salvo. Expira em: ${i.toISOString()}`),this.logger.log(`[Register] Iniciando envio de código por email: ${t.email}`);try{await this.notificationService.sendEmail(t.email,"Código de Verificação - GWAN",`Olá ${t.name},\n\nSeu código de verificação é: ${o}\n\nEste código é válido por 10 minutos.`),this.logger.log(`[Register] Email de verificação enviado com sucesso: ${t.email}`)}catch(e){this.logger.error(`[Register] Erro ao enviar email de verificação: ${e.message}`,e.stack)}this.logger.log(`[Register] Iniciando envio de código por WhatsApp: ${t.whatsapp}`);try{await this.notificationService.sendWhatsApp(t.whatsapp,`GWAN: Seu código de verificação é: ${o}. Válido por 10 minutos.`),this.logger.log(`[Register] Mensagem WhatsApp enviada com sucesso: ${t.whatsapp}`)}catch(e){this.logger.error(`[Register] Erro ao enviar mensagem WhatsApp: ${e.message}`,e.stack)}return this.logger.log(`[Register] Processo de registro concluído com sucesso para: ${t.email}`),t}catch(e){throw this.logger.error(`[Register] Erro durante o processo de registro: ${e.message}`,e.stack),e}}};t.RegisterUseCase=l,t.RegisterUseCase=l=i=r([(0,n.Injectable)(),a("design:paramtypes",[s.UserService,c.NotificationService])],l)},5511:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.RabbitMQService=void 0;const r=o(3563),a=o(3942);let n=class{constructor(){this.queueName="knowledge_base_processing"}async init(){try{this.connection=await a.connect(process.env.RABBITMQ_URL),this.channel=await this.connection.createChannel(),await this.channel.assertQueue(this.queueName,{durable:!0}),console.log("RabbitMQ conectado com sucesso")}catch(e){throw console.error("Erro ao conectar com RabbitMQ:",e),e}}async sendMessage(e){try{await this.channel.sendToQueue(this.queueName,Buffer.from(JSON.stringify(e)),{persistent:!0}),console.log("Mensagem enviada com sucesso:",e)}catch(e){throw console.error("Erro ao enviar mensagem:",e),e}}async closeConnection(){try{this.channel&&await this.channel.close(),this.connection&&await this.connection.close(),console.log("Conexão com RabbitMQ fechada com sucesso")}catch(e){throw console.error("Erro ao fechar conexão com RabbitMQ:",e),e}}};t.RabbitMQService=n,t.RabbitMQService=n=i([(0,r.Injectable)()],n)},5598:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateStatusUseCase=void 0;const n=o(3563),s=o(8516);let c=class{constructor(e){this.chatbotRepository=e}async execute(e,t,o){const i=await this.chatbotRepository.findById(t);if(!i)throw new n.NotFoundException(`Chatbot with ID ${t} not found`);if(i.userId.toString()!==e)throw new n.NotFoundException(`Chatbot with ID ${t} not found`);const r=await this.chatbotRepository.updateStatus(t,o.isActive);return this.mapToResponseDto(r)}mapToResponseDto(e){return{id:e.id,name:e.name,description:e.description,systemPrompt:e.systemPrompt,aiModel:e.aiModel,contentWindowSize:e.contentWindowSize,n8nId:e.n8nId,n8nWorkflowId:e.n8nWorkflowId,n8nChatUrl:e.n8nChatUrl,n8nChatRequireButtonClicktoStart:e.n8nChatRequireButtonClicktoStart,n8nChatTitle:e.n8nChatTitle,n8nChatSubtitle:e.n8nChatSubtitle,n8nChatInitialMessage:e.n8nChatInitialMessage,dataVector:e.dataVector,dataVectorSize:e.dataVectorSize,dataVectorIndex:e.dataVectorIndex,dataVectorNamespace:e.dataVectorNamespace,dataVectorModel:e.dataVectorModel,dataVectorEmbeddingsModel:e.dataVectorEmbeddingsModel,isActive:e.isActive,userId:e.userId.toString(),createdAt:e.createdAt,updatedAt:e.updatedAt}}};t.UpdateStatusUseCase=c,t.UpdateStatusUseCase=c=i([(0,n.Injectable)(),a(0,(0,n.Inject)(s.CHATBOT_REPOSITORY)),r("design:paramtypes",[Object])],c)},5657:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DeleteChatbotUseCase=void 0;const n=o(3563),s=o(8516);let c=class{constructor(e){this.chatbotRepository=e}async execute(e,t){const o=await this.chatbotRepository.findById(t);if(!o)throw new n.NotFoundException(`Chatbot with ID ${t} not found`);if(o.userId.toString()!==e)throw new n.NotFoundException(`Chatbot with ID ${t} not found`);await this.chatbotRepository.delete(t)}};t.DeleteChatbotUseCase=c,t.DeleteChatbotUseCase=c=i([(0,n.Injectable)(),a(0,(0,n.Inject)(s.CHATBOT_REPOSITORY)),r("design:paramtypes",[Object])],c)},5755:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.HelloModule=void 0;const r=o(3563),a=o(9057),n=o(2586),s=o(1403),c=o(308),d=o(1769);let l=class{};t.HelloModule=l,t.HelloModule=l=i([(0,r.Module)({controllers:[a.HelloController],providers:[{provide:d.HELLO_REPOSITORY,useClass:c.HelloRepositoryImpl},n.HelloService,s.GetHelloUseCase]})],l)},5839:e=>{e.exports=require("@nestjs/mongoose")},5971:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserRepository=void 0;const n=o(3563),s=o(5839),c=o(6037),d=o(1173),l=o(4815);let p=class extends l.BaseMongoRepository{constructor(e){super(e),this.userModel=e}async findByEmail(e){return this.userModel.findOne({email:e}).exec()}async findByWhatsApp(e){return this.userModel.findOne({whatsapp:e}).exec()}async updateProfile(e,t){return this.userModel.findByIdAndUpdate(e,{$set:t},{new:!0}).exec()}};t.UserRepository=p,t.UserRepository=p=i([(0,n.Injectable)(),a(0,(0,s.InjectModel)(d.User.name)),r("design:paramtypes",[c.Model])],p)},6037:e=>{e.exports=require("mongoose")},6291:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.JwtAuthGuard=void 0;const a=o(3563),n=o(9520);let s=i=class extends((0,n.AuthGuard)("jwt")){constructor(){super(...arguments),this.logger=new a.Logger(i.name),this.publicRoutes=["/api/auth/login","/api/auth/verify-login-code","/api/auth/register","/api/auth/verify-code"]}canActivate(e){const t=e.switchToHttp().getRequest(),o=t.path;if(this.logger.debug("[Auth] Headers recebidos:",t.headers),this.publicRoutes.includes(o))return this.logger.debug(`[Auth] Rota pública acessada: ${t.method} ${o}`),!0;this.logger.debug(`[Auth] Verificando autenticação para rota: ${t.method} ${o}`);const i=t.headers.authorization||t.headers.Authorization;if(this.logger.debug(`[Auth] Header de autorização: ${i}`),!i)return this.logger.warn("[Auth] Header de autorização não encontrado"),!1;if(!i.startsWith("Bearer "))return this.logger.warn('[Auth] Formato inválido do header de autorização. Deve começar com "Bearer "'),!1;const r=i.split(" ")[1];return this.logger.debug(`[Auth] Token JWT: ${r}`),super.canActivate(e)}handleRequest(e,t,o){if(e||!t)throw this.logger.error("[Auth] Erro na autenticação:",e),e||new a.UnauthorizedException("Token inválido ou expirado");return this.logger.debug(`[Auth] Usuário autenticado com sucesso: ${t.email}`),t}};t.JwtAuthGuard=s,t.JwtAuthGuard=s=i=r([(0,a.Injectable)()],s)},6320:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserNotFoundError=void 0;class o extends Error{constructor(e){super(`Usuário com ID "${e}" não encontrado.`),this.name="UserNotFoundError"}}t.UserNotFoundError=o},6467:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MongooseUserRepository=void 0;const n=o(3563),s=o(5839),c=o(6037),d=o(9336);let l=class{constructor(e){this.userModel=e}transformUser(e){if(!e)return null;const t=e.toObject();return{...t,id:t._id.toString(),_id:void 0}}async findById(e){const t=await this.userModel.findById(e).exec();return this.transformUser(t)}async findAll(){return(await this.userModel.find().exec()).map((e=>this.transformUser(e)))}async create(e){const t=await this.userModel.create(e);return this.transformUser(t)}async update(e,t){const o=await this.userModel.findByIdAndUpdate(e,t,{new:!0}).exec();return this.transformUser(o)}async delete(e){await this.userModel.findByIdAndDelete(e).exec()}async findByEmail(e){const t=new n.Logger("MongooseUserRepository");t.debug(`[FindByEmail] Executando query com email: "${e}"`);const o=this.userModel.collection.name,i=this.userModel.db.name;t.debug(`[FindByEmail] Buscando na collection: ${o} do banco: ${i}`);const r=await this.userModel.db.collection(o).findOne({email:e});t.debug("[FindByEmail] Resultado da query direta: "+(r?"Encontrado":"Não encontrado")),r&&t.debug(`[FindByEmail] Detalhes do usuário (query direta): ${JSON.stringify(r)}`);const a=await this.userModel.findOne({email:e}).exec();return t.debug("[FindByEmail] Resultado da query Mongoose: "+(a?"Usuário encontrado":"Usuário não encontrado")),a&&t.debug(`[FindByEmail] Detalhes do usuário (Mongoose): ${JSON.stringify(a.toObject())}`),this.transformUser(a)}async findByWhatsApp(e){const t=await this.userModel.findOne({whatsapp:e}).exec();return this.transformUser(t)}async findByVerificationCode(e){const t=await this.userModel.findOne({activationCode:e}).exec();return this.transformUser(t)}async updateVerificationStatus(e,t){await this.userModel.findByIdAndUpdate(e,{isVerified:t})}async updateVerificationCode(e,t,o){await this.userModel.findByIdAndUpdate(e,{verificationCode:t,verificationCodeExpiresAt:o})}async updateLoginCode(e,t,o){await this.userModel.findByIdAndUpdate(e,{loginCode:t,loginCodeExpiresAt:o}).exec()}async clearLoginCode(e){await this.userModel.findByIdAndUpdate(e,{loginCode:null,loginCodeExpiresAt:null}).exec()}async updateActivationCode(e,t,o){await this.userModel.findByIdAndUpdate(e,{activationCode:t,activationCodeExpiresAt:o}).exec()}async clearActivationCode(e){await this.userModel.findByIdAndUpdate(e,{activationCode:null,activationCodeExpiresAt:null}).exec()}async verifyUser(e){await this.userModel.findByIdAndUpdate(e,{isVerified:!0,isEmailVerified:!0}).exec()}async updateLastLogin(e){await this.userModel.findByIdAndUpdate(e,{lastLoginAt:new Date}).exec()}async deleteMany(e){await this.userModel.deleteMany(e).exec()}async updatePassword(e,t){await this.userModel.findByIdAndUpdate(e,{password:t}).exec()}};t.MongooseUserRepository=l,t.MongooseUserRepository=l=i([(0,n.Injectable)(),a(0,(0,s.InjectModel)(d.User.name)),r("design:paramtypes",[c.Model])],l)},6484:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UploadFileUseCase=void 0;const s=o(3563),c=o(6037),d=o(8088),l=o(8205);let p=i=class{constructor(e,t){this.storageService=e,this.bucketFileRepository=t,this.logger=new s.Logger(i.name)}async execute(e,t,o){if(!o)throw new s.BadRequestException("knowledgeBaseId é obrigatório para upload de arquivos");this.logger.debug(`[UploadFile] Iniciando upload para usuário: ${t} na base de conhecimento: ${o}`);const i=`${t}/${o}/${e.originalname}`;await this.storageService.uploadFile(e,i);const r=await this.storageService.getFileUrl(i),a=await this.bucketFileRepository.create({userId:new c.Types.ObjectId(t),originalName:e.originalname,fileName:i,size:e.size,mimeType:e.mimetype,url:r,bucketName:"datasets",knowledgeBaseId:new c.Types.ObjectId(o),status:l.FileStatus.AVAILABLE});return this.logger.debug(`[UploadFile] Upload concluído com sucesso: ${a.id}`),{id:a.id,originalname:e.originalname,filename:i,size:e.size,mimetype:e.mimetype,url:r,knowledgeBaseId:o,status:a.status}}};t.UploadFileUseCase=p,t.UploadFileUseCase=p=i=r([(0,s.Injectable)(),n(0,(0,s.Inject)(d.STORAGE_SERVICE)),n(1,(0,s.Inject)(d.BUCKET_FILE_REPOSITORY)),a("design:paramtypes",[Object,Object])],p)},6509:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AppController=void 0;const a=o(3563),n=o(2918);let s=class{constructor(e){this.appService=e}getHello(){return this.appService.getHello()}};t.AppController=s,i([(0,a.Get)(),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",String)],s.prototype,"getHello",null),t.AppController=s=i([(0,a.Controller)(),r("design:paramtypes",[n.AppService])],s)},6522:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateChatbotStatusDto=t.UpdateVectorConfigDto=t.UpdateN8nConfigDto=t.UpdateChatbotRequestDto=t.CreateChatbotDto=t.ListChatbotsResponseDto=t.ChatbotResponseDto=void 0;const a=o(9742),n=o(7403);let s=class{};t.ChatbotResponseDto=s,i([(0,a.ApiProperty)({description:"ID único do chatbot"}),r("design:type",String)],s.prototype,"id",void 0),i([(0,a.ApiProperty)({description:"Nome do chatbot"}),r("design:type",String)],s.prototype,"name",void 0),i([(0,a.ApiProperty)({description:"Descrição do chatbot"}),r("design:type",String)],s.prototype,"description",void 0),i([(0,a.ApiProperty)({description:"Prompt do sistema para o chatbot"}),r("design:type",String)],s.prototype,"systemPrompt",void 0),i([(0,a.ApiProperty)({description:"Modelo de IA utilizado"}),r("design:type",String)],s.prototype,"aiModel",void 0),i([(0,a.ApiProperty)({description:"Tamanho da janela de contexto"}),r("design:type",Number)],s.prototype,"contentWindowSize",void 0),i([(0,a.ApiProperty)({description:"ID do chatbot no n8n",required:!1}),r("design:type",String)],s.prototype,"n8nId",void 0),i([(0,a.ApiProperty)({description:"ID do workflow no n8n",required:!1}),r("design:type",String)],s.prototype,"n8nWorkflowId",void 0),i([(0,a.ApiProperty)({description:"URL do webhook do chat no n8n",required:!1}),r("design:type",String)],s.prototype,"n8nChatUrl",void 0),i([(0,a.ApiProperty)({description:"Se o chat requer clique no botão para iniciar",required:!1}),r("design:type",Boolean)],s.prototype,"n8nChatRequireButtonClicktoStart",void 0),i([(0,a.ApiProperty)({description:"Título do chat",required:!1}),r("design:type",String)],s.prototype,"n8nChatTitle",void 0),i([(0,a.ApiProperty)({description:"Subtítulo do chat",required:!1}),r("design:type",String)],s.prototype,"n8nChatSubtitle",void 0),i([(0,a.ApiProperty)({description:"Mensagem inicial do chat",required:!1}),r("design:type",String)],s.prototype,"n8nChatInitialMessage",void 0),i([(0,a.ApiProperty)({description:"Nome do vetor de dados",required:!1}),r("design:type",String)],s.prototype,"dataVector",void 0),i([(0,a.ApiProperty)({description:"Tamanho do vetor de dados",required:!1}),r("design:type",Number)],s.prototype,"dataVectorSize",void 0),i([(0,a.ApiProperty)({description:"Índice do vetor de dados",required:!1}),r("design:type",String)],s.prototype,"dataVectorIndex",void 0),i([(0,a.ApiProperty)({description:"Namespace do vetor de dados",required:!1}),r("design:type",String)],s.prototype,"dataVectorNamespace",void 0),i([(0,a.ApiProperty)({description:"Modelo do vetor de dados",required:!1}),r("design:type",String)],s.prototype,"dataVectorModel",void 0),i([(0,a.ApiProperty)({description:"Modelo de embeddings do vetor de dados",required:!1}),r("design:type",String)],s.prototype,"dataVectorEmbeddingsModel",void 0),i([(0,a.ApiProperty)({description:"Status de ativação do chatbot"}),r("design:type",Boolean)],s.prototype,"isActive",void 0),i([(0,a.ApiProperty)({description:"ID do usuário proprietário do chatbot"}),r("design:type",String)],s.prototype,"userId",void 0),i([(0,a.ApiProperty)({description:"Data de criação do chatbot"}),r("design:type",Date)],s.prototype,"createdAt",void 0),i([(0,a.ApiProperty)({description:"Data da última atualização do chatbot"}),r("design:type",Date)],s.prototype,"updatedAt",void 0),t.ChatbotResponseDto=s=i([(0,a.ApiSchema)({name:"ChatbotResponseModel"})],s);let c=class{};t.ListChatbotsResponseDto=c,i([(0,a.ApiProperty)({type:()=>[s]}),r("design:type",Array)],c.prototype,"data",void 0),i([(0,a.ApiProperty)(),r("design:type",Number)],c.prototype,"total",void 0),i([(0,a.ApiProperty)(),r("design:type",Number)],c.prototype,"page",void 0),i([(0,a.ApiProperty)(),r("design:type",Number)],c.prototype,"limit",void 0),t.ListChatbotsResponseDto=c=i([(0,a.ApiSchema)({name:"ChatbotListResponseModel"})],c);let d=class{};t.CreateChatbotDto=d,i([(0,a.ApiProperty)({description:"Nome do chatbot"}),(0,n.IsString)(),(0,n.IsNotEmpty)(),r("design:type",String)],d.prototype,"name",void 0),i([(0,a.ApiProperty)({description:"Descrição do chatbot"}),(0,n.IsString)(),(0,n.IsNotEmpty)(),r("design:type",String)],d.prototype,"description",void 0),i([(0,a.ApiProperty)({description:"Prompt do sistema para o chatbot"}),(0,n.IsString)(),(0,n.IsNotEmpty)(),r("design:type",String)],d.prototype,"systemPrompt",void 0),i([(0,a.ApiProperty)({description:"Modelo de IA utilizado"}),(0,n.IsString)(),(0,n.IsNotEmpty)(),r("design:type",String)],d.prototype,"aiModel",void 0),i([(0,a.ApiProperty)({description:"Tamanho da janela de contexto",default:12}),(0,n.IsNumber)(),(0,n.Min)(1),(0,n.Max)(32),(0,n.IsOptional)(),r("design:type",Number)],d.prototype,"contentWindowSize",void 0),i([(0,a.ApiProperty)({description:"Máximo de tokens para respostas da IA",default:2e3}),(0,n.IsNumber)(),(0,n.Min)(1),(0,n.IsOptional)(),r("design:type",Number)],d.prototype,"maxTokens",void 0),t.CreateChatbotDto=d=i([(0,a.ApiSchema)({name:"ChatbotCreateModel"})],d);let l=class{};t.UpdateChatbotRequestDto=l,i([(0,a.ApiProperty)({description:"Nome do chatbot"}),(0,n.IsString)(),(0,n.IsOptional)(),r("design:type",String)],l.prototype,"name",void 0),i([(0,a.ApiProperty)({description:"Descrição do chatbot"}),(0,n.IsString)(),(0,n.IsOptional)(),r("design:type",String)],l.prototype,"description",void 0),i([(0,a.ApiProperty)({description:"Prompt do sistema para o chatbot"}),(0,n.IsString)(),(0,n.IsOptional)(),r("design:type",String)],l.prototype,"systemPrompt",void 0),i([(0,a.ApiProperty)({description:"Modelo de IA utilizado"}),(0,n.IsString)(),(0,n.IsOptional)(),r("design:type",String)],l.prototype,"aiModel",void 0),i([(0,a.ApiProperty)({description:"Tamanho da janela de contexto",default:12}),(0,n.IsNumber)(),(0,n.Min)(1),(0,n.Max)(32),(0,n.IsOptional)(),r("design:type",Number)],l.prototype,"contentWindowSize",void 0),i([(0,a.ApiProperty)({description:"Máximo de tokens para respostas da IA",default:2e3}),(0,n.IsNumber)(),(0,n.Min)(1),(0,n.IsOptional)(),r("design:type",Number)],l.prototype,"maxTokens",void 0),t.UpdateChatbotRequestDto=l=i([(0,a.ApiSchema)({name:"ChatbotUpdateRequestModel"})],l);let p=class{};t.UpdateN8nConfigDto=p,i([(0,a.ApiProperty)({description:"ID do chatbot no n8n"}),(0,n.IsString)(),(0,n.IsNotEmpty)(),r("design:type",String)],p.prototype,"n8nId",void 0),i([(0,a.ApiProperty)({description:"ID do workflow no n8n"}),(0,n.IsString)(),(0,n.IsNotEmpty)(),r("design:type",String)],p.prototype,"n8nWorkflowId",void 0),i([(0,a.ApiProperty)({description:"URL do webhook do chat no n8n"}),(0,n.IsUrl)(),(0,n.IsNotEmpty)(),r("design:type",String)],p.prototype,"n8nChatUrl",void 0),i([(0,a.ApiProperty)({description:"Se o chat requer clique no botão para iniciar"}),(0,n.IsBoolean)(),(0,n.IsOptional)(),r("design:type",Boolean)],p.prototype,"n8nChatRequireButtonClicktoStart",void 0),i([(0,a.ApiProperty)({description:"Título do chat"}),(0,n.IsString)(),(0,n.IsOptional)(),r("design:type",String)],p.prototype,"n8nChatTitle",void 0),i([(0,a.ApiProperty)({description:"Subtítulo do chat"}),(0,n.IsString)(),(0,n.IsOptional)(),r("design:type",String)],p.prototype,"n8nChatSubtitle",void 0),i([(0,a.ApiProperty)({description:"Mensagem inicial do chat"}),(0,n.IsString)(),(0,n.IsOptional)(),r("design:type",String)],p.prototype,"n8nChatInitialMessage",void 0),t.UpdateN8nConfigDto=p=i([(0,a.ApiSchema)({name:"ChatbotN8nConfigModel"})],p);let u=class{};t.UpdateVectorConfigDto=u,i([(0,a.ApiProperty)({description:"Nome do vetor de dados"}),(0,n.IsString)(),(0,n.IsNotEmpty)(),r("design:type",String)],u.prototype,"dataVector",void 0),i([(0,a.ApiProperty)({description:"Tamanho do vetor de dados"}),(0,n.IsNumber)(),(0,n.Min)(1),(0,n.IsNotEmpty)(),r("design:type",Number)],u.prototype,"dataVectorSize",void 0),i([(0,a.ApiProperty)({description:"Índice do vetor de dados"}),(0,n.IsString)(),(0,n.IsNotEmpty)(),r("design:type",String)],u.prototype,"dataVectorIndex",void 0),i([(0,a.ApiProperty)({description:"Namespace do vetor de dados"}),(0,n.IsString)(),(0,n.IsNotEmpty)(),r("design:type",String)],u.prototype,"dataVectorNamespace",void 0),i([(0,a.ApiProperty)({description:"Modelo do vetor de dados"}),(0,n.IsString)(),(0,n.IsNotEmpty)(),r("design:type",String)],u.prototype,"dataVectorModel",void 0),i([(0,a.ApiProperty)({description:"Modelo de embeddings do vetor de dados"}),(0,n.IsString)(),(0,n.IsNotEmpty)(),r("design:type",String)],u.prototype,"dataVectorEmbeddingsModel",void 0),t.UpdateVectorConfigDto=u=i([(0,a.ApiSchema)({name:"ChatbotVectorConfigModel"})],u);let g=class{};t.UpdateChatbotStatusDto=g,i([(0,a.ApiProperty)({description:"Status de ativação do chatbot",type:Boolean,example:!0}),(0,n.IsBoolean)(),(0,n.IsNotEmpty)(),r("design:type",Boolean)],g.prototype,"isActive",void 0),t.UpdateChatbotStatusDto=g=i([(0,a.ApiSchema)({name:"ChatbotStatusUpdateModel"})],g)},6717:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.EmailWorkerModule=void 0;const r=o(3563),a=o(531);let n=class{};t.EmailWorkerModule=n,t.EmailWorkerModule=n=i([(0,r.Module)({providers:[a.EmailWorker]})],n)},6746:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.RabbitMQService=void 0;const n=o(3563),s=o(3428),c=o(9316);let d=i=class{constructor(e){this.configService=e,this.logger=new n.Logger(i.name);const t=this.configService.get("RABBITMQ_URL");if(!t)throw new Error("RABBITMQ_URL not configured");this.connection=c.connect([t]),this.connection.on("connect",(()=>{this.logger.log("Conectado ao RabbitMQ")})),this.connection.on("disconnect",(e=>{this.logger.error("Desconectado do RabbitMQ",e)})),this.channelWrapper=this.connection.createChannel({setup:e=>Promise.all([e.assertExchange("knowledge.exchange","topic",{durable:!0})])})}async onModuleInit(){try{await this.channelWrapper.waitForConnect(),this.logger.log("Canal RabbitMQ inicializado com sucesso")}catch(e){throw this.logger.error("Erro ao inicializar canal RabbitMQ:",e),e}}async onModuleDestroy(){try{await this.channelWrapper.close(),await this.connection.close(),this.logger.log("Conexão com RabbitMQ fechada com sucesso")}catch(e){this.logger.error("Erro ao fechar conexão com RabbitMQ:",e)}}async sendMessage(e){try{const t="knowledge.exchange",o="knowledge.process";await this.channelWrapper.publish(t,o,Buffer.from(JSON.stringify(e)),{persistent:!0}),this.logger.debug(`Mensagem publicada com sucesso: ${o}`,e)}catch(e){throw this.logger.error("Erro ao publicar mensagem no RabbitMQ:",e),e}}async publish(e,t){try{const o="knowledge.exchange";await this.channelWrapper.publish(o,e,Buffer.from(JSON.stringify(t)),{persistent:!0}),this.logger.debug(`Mensagem publicada com sucesso: ${e}`,t)}catch(e){throw this.logger.error("Erro ao publicar mensagem no RabbitMQ:",e),e}}async consume(e,t){try{await this.channelWrapper.addSetup((async o=>{await o.assertQueue(e,{durable:!0}),await o.consume(e,(async e=>{if(e)try{const i=JSON.parse(e.content.toString());await t(i),o.ack(e)}catch(t){this.logger.error("Erro ao processar mensagem:",t),o.nack(e,!1,!0)}}))})),this.logger.log(`Consumidor iniciado para a fila: ${e}`)}catch(e){throw this.logger.error("Erro ao iniciar consumidor:",e),e}}};t.RabbitMQService=d,t.RabbitMQService=d=i=r([(0,n.Injectable)(),a("design:paramtypes",[s.ConfigService])],d)},6815:e=>{e.exports=require("@nestjs/jwt")},7037:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.VerifyLoginCodeUseCase=void 0;const n=o(3563),s=o(2649),c=o(6815),d=o(7176);let l=i=class extends d.BaseUseCase{constructor(e,t){super(e),this.userService=e,this.jwtService=t,this.logger=new n.Logger(i.name)}async execute(e){this.logger.log(`[VerifyLoginCode] Iniciando verificação de código para: ${e.email}`);try{this.logger.debug(`[VerifyLoginCode] Buscando usuário por email: ${e.email}`);const t=await this.userService.findByEmail(e.email);if(!t)throw this.logger.warn(`[VerifyLoginCode] Usuário não encontrado: ${e.email}`),new n.NotFoundException({message:"Usuário não encontrado",code:"USER_NOT_FOUND",details:{email:e.email}});if(!t.loginCodeExpiresAt||t.loginCodeExpiresAt<new Date)throw this.logger.warn(`[VerifyLoginCode] Código expirado para usuário: ${t.id}`),new n.BadRequestException({message:"Código de login expirado",code:"LOGIN_CODE_EXPIRED",details:{email:e.email}});if(t.loginCode!==e.code)throw this.logger.warn(`[VerifyLoginCode] Código inválido para usuário: ${t.id}`),new n.BadRequestException({message:"Código de login inválido",code:"INVALID_LOGIN_CODE",details:{email:e.email}});this.logger.debug(`[VerifyLoginCode] Atualizando último login para usuário: ${t.id}`);const o=await this.userService.updateLastLogin(t.id);this.logger.debug(`[VerifyLoginCode] Último login atualizado com sucesso: ${o.id}`),this.logger.debug(`[VerifyLoginCode] Gerando token JWT para usuário: ${o.id}`);const i=this.generateToken(o);return this.logger.debug(`[VerifyLoginCode] Token JWT gerado com sucesso para usuário: ${o.id}`),this.logger.log(`[VerifyLoginCode] Processo de verificação concluído com sucesso para: ${o.email}`),this.createAuthResponse(o,i)}catch(e){throw this.logger.error(`[VerifyLoginCode] Erro durante a verificação: ${e.message}`,e.stack),e}}generateToken(e){const t={sub:e.id,email:e.email,isEmailVerified:e.isEmailVerified};return this.jwtService.sign(t)}createAuthResponse(e,t){return{accessToken:t,user:this.mapToUserResponseDto(e)}}mapToUserResponseDto(e){return{id:e.id,name:e.name,email:e.email,whatsapp:e.whatsapp,isEmailVerified:e.isEmailVerified,isActive:e.isActive,isVerified:e.isVerified,createdAt:e.createdAt,updatedAt:e.updatedAt}}};t.VerifyLoginCodeUseCase=l,t.VerifyLoginCodeUseCase=l=i=r([(0,n.Injectable)(),a("design:paramtypes",[s.UserService,c.JwtService])],l)},7176:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseUseCase=void 0,t.BaseUseCase=class{constructor(e){this.service=e}}},7362:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MongoDBUserRepository=void 0;const n=o(3563),s=o(5839),c=o(6037),d=o(8756);let l=class{constructor(e){this.userModel=e}async findById(e){const t=await this.userModel.findById(e).exec();return t?d.User.create(t._id.toString(),t.name,t.email,t.isVerified):null}async findByEmail(e){const t=await this.userModel.findOne({email:e}).exec();return t?d.User.create(t._id.toString(),t.name,t.email,t.isVerified):null}async create(e){const t=await this.userModel.create({name:e.name,email:e.email,isVerified:e.isVerified});return d.User.create(t._id.toString(),t.name,t.email,t.isVerified)}async update(e){const t=await this.userModel.findByIdAndUpdate(e.id,{name:e.name,isVerified:e.isVerified},{new:!0}).exec();return t?d.User.create(t._id.toString(),t.name,t.email,t.isVerified):null}async delete(e){await this.userModel.findByIdAndDelete(e).exec()}async list(){return(await this.userModel.find().exec()).map((e=>d.User.create(e._id.toString(),e.name,e.email,e.isVerified)))}};t.MongoDBUserRepository=l,t.MongoDBUserRepository=l=i([(0,n.Injectable)(),a(0,(0,s.InjectModel)("User")),r("design:paramtypes",[c.Model])],l)},7403:e=>{e.exports=require("class-validator")},7416:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.GetUserUseCase=void 0;const n=o(3563),s=o(6320);let c=class{constructor(e){this.userRepository=e}async execute(e){const t=await this.userRepository.findById(e);if(!t)throw new s.UserNotFoundError(e);return t}};t.GetUserUseCase=c,t.GetUserUseCase=c=i([(0,n.Injectable)(),a(0,(0,n.Inject)("IUserRepository")),r("design:paramtypes",[Object])],c)},8088:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BUCKET_FILE_REPOSITORY=t.STORAGE_SERVICE=void 0,t.STORAGE_SERVICE="STORAGE_SERVICE",t.BUCKET_FILE_REPOSITORY="BUCKET_FILE_REPOSITORY"},8205:(e,t)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.FileStatus=void 0,function(e){e.AVAILABLE="available",e.PROCESSING="processing",e.PROCESSED="processed",e.ERROR="error"}(o||(t.FileStatus=o={}))},8240:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.KnowledgeService=void 0;const s=o(3563),c=o(5839),d=o(6037),l=o(8905),p=o(3868),u=o(5511),g=o(1278),f=o(9693);let h=i=class{constructor(e,t,o,r){this.knowledgeBaseModel=e,this.datasetService=t,this.rabbitMQService=o,this.startProcessUseCase=r,this.logger=new s.Logger(i.name)}async createKnowledgeBase(e,t,o){const i={userId:e,name:t,description:o,status:f.KnowledgeBaseStatus.NEW};console.log("createDto",i);const r=new this.knowledgeBaseModel(i),a=await r.save(),n={knowledgeBaseId:a._id,userId:a.userId};return console.log("message",n),await this.rabbitMQService.sendMessage(n),a}async listUserKnowledgeBases(e){return this.knowledgeBaseModel.find({userId:e}).exec()}async getKnowledgeBaseById(e,t){const o=await this.knowledgeBaseModel.findOne({_id:e,userId:t}).exec();if(!o)throw new s.NotFoundException(`Knowledge base with ID ${e} not found`);return o}async update(e,t){const o=await this.knowledgeBaseModel.findByIdAndUpdate(e,t,{new:!0}).exec();if(!o)throw new s.NotFoundException(`Knowledge base with ID ${e} not found`);return o}async deleteKnowledgeBase(e,t){if(0===(await this.knowledgeBaseModel.deleteOne({_id:e,userId:t}).exec()).deletedCount)throw new s.NotFoundException(`Knowledge base with ID ${e} not found`)}async startProcess(e,t,o){return await this.startProcessUseCase.execute(e,t,o),this.getKnowledgeBaseById(e,t)}};t.KnowledgeService=h,t.KnowledgeService=h=i=r([(0,s.Injectable)(),n(0,(0,c.InjectModel)(l.KnowledgeBase.name)),a("design:paramtypes",[d.Model,p.DatasetService,u.RabbitMQService,g.StartProcessUseCase])],h)},8254:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseService=void 0,t.BaseService=class{constructor(e){this.repository=e}async findById(e){return this.repository.findById(e)}async findAll(){return this.repository.findAll()}async create(e){return this.repository.create(e)}async update(e,t){return this.repository.update(e,t)}async delete(e){return this.repository.delete(e)}}},8343:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatbotService=void 0;const s=o(3563),c=o(8254),d=o(8516);let l=i=class extends c.BaseService{constructor(e){super(e),this.chatbotRepository=e,this.logger=new s.Logger(i.name)}async findByUserId(e){return this.logger.debug(`[FindByUserId] Buscando chatbots do usuário: ${e}`),this.chatbotRepository.findByUserId(e)}async findByName(e){return this.logger.debug(`[FindByName] Buscando chatbot por nome: ${e}`),this.chatbotRepository.findByName(e)}async findByN8nId(e){return this.logger.debug(`[FindByN8nId] Buscando chatbot por n8nId: ${e}`),this.chatbotRepository.findByN8nId(e)}async updateStatus(e,t){return this.logger.debug(`[UpdateStatus] Atualizando status do chatbot: ${e}`),this.chatbotRepository.updateStatus(e,t)}async updateN8nConfig(e,t){return this.logger.debug(`[UpdateN8nConfig] Atualizando configuração n8n do chatbot: ${e}`),this.chatbotRepository.updateN8nConfig(e,t)}async updateVectorConfig(e,t){return this.logger.debug(`[UpdateVectorConfig] Atualizando configuração de vetor do chatbot: ${e}`),this.chatbotRepository.updateVectorConfig(e,t)}};t.ChatbotService=l,t.ChatbotService=l=i=r([(0,s.Injectable)(),n(0,(0,s.Inject)(d.CHATBOT_REPOSITORY)),a("design:paramtypes",[Object])],l)},8375:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.KnowledgeModule=t.KNOWLEDGE_BASE_REPOSITORY=t.KNOWLEDGE_REPOSITORY=void 0;const a=o(3563),n=o(5839),s=o(3139),c=o(8240),d=o(8905),l=o(9129),p=o(5511),u=o(8627),g=o(1177),f=o(1894),h=o(1902),y=o(2983),m=o(5450),b=o(1278),v=o(8088);t.KNOWLEDGE_REPOSITORY="KNOWLEDGE_REPOSITORY",t.KNOWLEDGE_BASE_REPOSITORY="KNOWLEDGE_BASE_REPOSITORY";let R=class{constructor(e){this.rabbitMQService=e}async onModuleInit(){await this.rabbitMQService.init()}async onModuleDestroy(){await this.rabbitMQService.closeConnection()}};t.KnowledgeModule=R,t.KnowledgeModule=R=i([(0,a.Module)({imports:[n.MongooseModule.forFeature([{name:d.KnowledgeBase.name,schema:d.KnowledgeBaseSchema},{name:y.Knowledge.name,schema:y.KnowledgeSchema}]),l.AuthModule,u.DatasetModule,g.RabbitMQModule],controllers:[s.KnowledgeController],providers:[c.KnowledgeService,p.RabbitMQService,h.KnowledgeRepository,m.KnowledgeBaseRepository,{provide:t.KNOWLEDGE_REPOSITORY,useClass:h.KnowledgeRepository},{provide:t.KNOWLEDGE_BASE_REPOSITORY,useClass:m.KnowledgeBaseRepository},{provide:f.DomainKnowledgeService,useFactory:e=>new f.DomainKnowledgeService(e),inject:[t.KNOWLEDGE_REPOSITORY]},{provide:b.StartProcessUseCase,useFactory:(e,t,o)=>new b.StartProcessUseCase(e,t,o),inject:[t.KNOWLEDGE_BASE_REPOSITORY,v.BUCKET_FILE_REPOSITORY,p.RabbitMQService]}],exports:[c.KnowledgeService,f.DomainKnowledgeService]}),r("design:paramtypes",[p.RabbitMQService])],R)},8516:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CHATBOT_REPOSITORY=void 0,t.CHATBOT_REPOSITORY="CHATBOT_REPOSITORY"},8627:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.DatasetModule=void 0;const r=o(3563),a=o(9556),n=o(5839),s=o(3300),c=o(6484),d=o(2126),l=o(330),p=o(3298),u=o(9762),g=o(4831),f=o(8088),h=o(3868);let y=class{};t.DatasetModule=y,t.DatasetModule=y=i([(0,r.Module)({imports:[a.MulterModule.register({dest:"./datasets"}),n.MongooseModule.forFeature([{name:u.BucketFile.name,schema:u.BucketFileSchema}])],controllers:[s.DatasetController],providers:[{provide:f.STORAGE_SERVICE,useClass:p.MinioStorageService},{provide:f.BUCKET_FILE_REPOSITORY,useClass:g.BucketFileRepositoryImpl},c.UploadFileUseCase,d.ListFilesUseCase,l.DeleteFileUseCase,p.MinioStorageService,g.BucketFileRepositoryImpl,h.DatasetService],exports:[c.UploadFileUseCase,d.ListFilesUseCase,l.DeleteFileUseCase,p.MinioStorageService,h.DatasetService,{provide:f.STORAGE_SERVICE,useClass:p.MinioStorageService},{provide:f.BUCKET_FILE_REPOSITORY,useClass:g.BucketFileRepositoryImpl}]})],y)},8756:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0;const i=o(9557),r=o(1960);class a{constructor(e,t,o,i,r,a){this._id=e,this._name=t,this._email=o,this._isVerified=i,this._createdAt=r,this._updatedAt=a}static create(e,t,o,n=!1){return new a(e,i.Name.create(t),r.Email.create(o),n,new Date,new Date)}get id(){return this._id}get name(){return this._name.getValue()}get email(){return this._email.getValue()}get isVerified(){return this._isVerified}get createdAt(){return this._createdAt}get updatedAt(){return this._updatedAt}updateName(e){this._name=i.Name.create(e),this._updatedAt=new Date}verify(){this._isVerified=!0,this._updatedAt=new Date}toJSON(){return{id:this._id,name:this._name.getValue(),email:this._email.getValue(),isVerified:this._isVerified,createdAt:this._createdAt,updatedAt:this._updatedAt}}}t.User=a},8781:e=>{e.exports=require("@nestjs/core")},8873:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatbotsModule=void 0;const r=o(3563),a=o(5839),n=o(4039),s=o(3588),c=o(2513),d=o(643),l=o(5657),p=o(3599),u=o(198),g=o(5598),f=o(1296),h=o(8516),y=o(5194),m=o(8343);let b=class{};t.ChatbotsModule=b,t.ChatbotsModule=b=i([(0,r.Module)({imports:[a.MongooseModule.forFeature([{name:"Chatbot",schema:y.ChatbotSchemaFactory}])],controllers:[n.ChatbotController],providers:[m.ChatbotService,s.CreateChatbotUseCase,c.ListChatbotsUseCase,d.UpdateChatbotUseCase,l.DeleteChatbotUseCase,p.UpdateN8nConfigUseCase,u.UpdateVectorConfigUseCase,g.UpdateStatusUseCase,{provide:h.CHATBOT_REPOSITORY,useClass:f.MongoDBChatbotRepository}],exports:[h.CHATBOT_REPOSITORY]})],b)},8905:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.KnowledgeBaseSchema=t.KnowledgeBase=void 0;const a=o(5839),n=o(6037);let s=class extends n.Document{};t.KnowledgeBase=s,i([(0,a.Prop)({required:!0}),r("design:type",String)],s.prototype,"userId",void 0),i([(0,a.Prop)({required:!0}),r("design:type",String)],s.prototype,"name",void 0),i([(0,a.Prop)(),r("design:type",String)],s.prototype,"description",void 0),i([(0,a.Prop)({default:"new"}),r("design:type",String)],s.prototype,"status",void 0),i([(0,a.Prop)(),r("design:type",String)],s.prototype,"error",void 0),i([(0,a.Prop)({type:Object}),r("design:type",Object)],s.prototype,"metadata",void 0),t.KnowledgeBase=s=i([(0,a.Schema)({timestamps:!0})],s),t.KnowledgeBaseSchema=a.SchemaFactory.createForClass(s)},8916:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.KnowledgeMapper=void 0,t.KnowledgeMapper=class{static toEntity(e,t){return{title:e.title,content:e.content,category:e.category,tags:e.tags||[],authorId:t}}static toUpdateEntity(e){const t={};return e.title&&(t.title=e.title),e.content&&(t.content=e.content),e.category&&(t.category=e.category),e.tags&&(t.tags=e.tags),t}static toResponseDto(e){return{id:e.id,title:e.title,content:e.content,category:e.category,tags:e.tags,authorId:e.authorId,createdAt:e.createdAt,updatedAt:e.updatedAt}}}},8930:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.UserSchemaFactory=t.UserSchema=void 0;const a=o(5839),n=o(6037);let s=class extends n.Document{};t.UserSchema=s,i([(0,a.Prop)({required:!0}),r("design:type",String)],s.prototype,"name",void 0),i([(0,a.Prop)({required:!0,unique:!0}),r("design:type",String)],s.prototype,"email",void 0),i([(0,a.Prop)({required:!0,default:!1}),r("design:type",Boolean)],s.prototype,"isVerified",void 0),t.UserSchema=s=i([(0,a.Schema)({timestamps:!0})],s),t.UserSchemaFactory=a.SchemaFactory.createForClass(s)},8945:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.HealthModule=void 0;const r=o(3563),a=o(9697);let n=class{};t.HealthModule=n,t.HealthModule=n=i([(0,r.Module)({controllers:[a.HealthController]})],n)},9e3:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.RabbitMQService=void 0;const n=o(3563),s=o(3428),c=o(3942);let d=i=class{constructor(e){this.configService=e,this.logger=new n.Logger(i.name),this.connect()}async connect(){try{this.logger.log("Iniciando conexão com RabbitMQ...");const e=this.configService.get("RABBITMQ_URL");if(!e)throw new Error("RABBITMQ_URI não está definida nas variáveis de ambiente");const t=await c.connect(e);this.connection=t;const o=await t.createChannel();this.channel=o,this.logger.log("Declarando filas..."),await this.channel.assertQueue("email_notifications",{durable:!0,arguments:{"x-message-ttl":864e5,"x-dead-letter-exchange":"email_notifications_dlx","x-dead-letter-routing-key":"email_notifications"}}),await this.channel.assertQueue("whatsapp_notifications",{durable:!0}),this.logger.log("Filas declaradas com sucesso"),this.logger.log("[RabbitMQ] Conectado com sucesso")}catch(e){this.logger.error("[RabbitMQ] Erro ao conectar:",e),this.logger.log("[RabbitMQ] Tentando reconectar em 5 segundos..."),setTimeout((()=>this.connect()),5e3)}}async sendToQueue(e,t){try{this.logger.log(`Verificando conexão com RabbitMQ para envio à fila ${e}...`),this.channel||(this.logger.log("Canal não encontrado, tentando reconectar..."),await this.connect());const o=Buffer.from(JSON.stringify(t));this.logger.debug(`Enviando mensagem para fila ${e}: ${o.toString()}`),await this.channel.sendToQueue(e,o,{persistent:!0}),this.logger.log(`[RabbitMQ] Mensagem enviada com sucesso para a fila ${e}`)}catch(t){throw this.logger.error(`[RabbitMQ] Erro ao enviar mensagem para a fila ${e}:`,t),t}}async closeConnection(){try{if(this.logger.log("Fechando conexão com RabbitMQ..."),this.channel&&(await this.channel.close(),this.logger.log("Canal fechado com sucesso")),this.connection){const e=this.connection;await e.close(),this.logger.log("Conexão fechada com sucesso")}}catch(e){this.logger.error("[RabbitMQ] Erro ao fechar conexão:",e)}}};t.RabbitMQService=d,t.RabbitMQService=d=i=r([(0,n.Injectable)(),a("design:paramtypes",[s.ConfigService])],d)},9053:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.LoginUseCase=void 0;const n=o(3563),s=o(2649),c=o(1477),d=o(7176),l=o(1960);let p=i=class extends d.BaseUseCase{constructor(e,t){super(e),this.userService=e,this.notificationService=t,this.logger=new n.Logger(i.name)}async execute(e){const t=l.Email.create(e.email).getValue();this.logger.log(`[Login] Iniciando processo de login para: ${t}`);try{this.logger.debug(`[Login] Buscando usuário por email: ${t}`);const e=await this.userService.findByEmail(t);if(!e)throw this.logger.warn(`[Login] Usuário não encontrado: ${t}`),new n.NotFoundException({message:"Usuário não encontrado",code:"USER_NOT_FOUND",details:{email:t}});if(!e.isVerified)throw this.logger.warn(`[Login] Tentativa de login com usuário não verificado: ${t}`),new n.BadRequestException({message:"Usuário não está verificado",code:"USER_NOT_VERIFIED",details:{email:t}});const o=Math.floor(1e5+9e5*Math.random()).toString(),i=new Date;i.setMinutes(i.getMinutes()+10),this.logger.debug(`[Login] Gerando código de login para usuário: ${e.id}`),await this.userService.updateLoginCode(e.id,o,i),this.logger.debug(`[Login] Código de login gerado e salvo. Expira em: ${i.toISOString()}`),this.logger.log(`[Login] Iniciando envio de código por email: ${e.email}`);try{await this.notificationService.sendEmail(e.email,"Código de Login - GWAN",`Olá ${e.name},\n\nSeu código de login é: ${o}\n\nEste código é válido por 10 minutos.`),this.logger.log(`[Login] Email de login enviado com sucesso: ${e.email}`)}catch(e){this.logger.error(`[Login] Erro ao enviar email de login: ${e.message}`,e.stack)}this.logger.log(`[Login] Iniciando envio de código por WhatsApp: ${e.whatsapp}`);try{await this.notificationService.sendWhatsApp(e.whatsapp,`GWAN: Seu código de login é: ${o}. Válido por 10 minutos.`),this.logger.log(`[Login] Mensagem WhatsApp enviada com sucesso: ${e.whatsapp}`)}catch(e){this.logger.error(`[Login] Erro ao enviar mensagem WhatsApp: ${e.message}`,e.stack)}return this.logger.log(`[Login] Processo de login concluído com sucesso para: ${e.email}`),e}catch(e){throw this.logger.error(`[Login] Erro durante o processo de login: ${e.message}`,e.stack),e}}};t.LoginUseCase=p,t.LoginUseCase=p=i=r([(0,n.Injectable)(),a("design:paramtypes",[s.UserService,c.NotificationService])],p)},9057:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.HelloController=void 0;const a=o(3563),n=o(1403);let s=class{constructor(e){this.getHelloUseCase=e}async getHello(){return this.getHelloUseCase.execute()}};t.HelloController=s,i([(0,a.Get)(),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],s.prototype,"getHello",null),t.HelloController=s=i([(0,a.Controller)("hello"),r("design:paramtypes",[n.GetHelloUseCase])],s)},9129:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthModule=void 0;const r=o(3563),a=o(5839),n=o(6815),s=o(3428),c=o(3444),d=o(9336),l=o(6467),p=o(5495),u=o(9053),g=o(4813),f=o(7037),h=o(2649),y=o(1477),m=o(9e3),b=o(9603),v=o(6291),R=process.env.JWT_SECRET||"gwan-secret-key-production-2024";let w=class{};t.AuthModule=w,t.AuthModule=w=i([(0,r.Module)({imports:[s.ConfigModule,a.MongooseModule.forFeature([{name:d.User.name,schema:d.UserSchema}]),n.JwtModule.register({secret:R,signOptions:{expiresIn:"1d"}})],controllers:[c.AuthController],providers:[p.RegisterUseCase,u.LoginUseCase,g.VerifyCodeUseCase,f.VerifyLoginCodeUseCase,y.NotificationService,m.RabbitMQService,h.UserService,b.JwtStrategy,v.JwtAuthGuard,{provide:"IUserRepository",useClass:l.MongooseUserRepository}],exports:[h.UserService,b.JwtStrategy,v.JwtAuthGuard]})],w)},9316:e=>{e.exports=require("amqp-connection-manager")},9336:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.UserSchema=t.User=void 0;const a=o(5839),n=o(829),s=o(7403),c=o(9742);let d=class extends n.BaseEntity{};t.User=d,i([(0,c.ApiProperty)({description:"Nome do usuário"}),(0,a.Prop)({required:!0}),(0,s.IsString)(),r("design:type",String)],d.prototype,"name",void 0),i([(0,c.ApiProperty)({description:"Email do usuário"}),(0,a.Prop)({required:!0,unique:!0}),(0,s.IsEmail)(),r("design:type",String)],d.prototype,"email",void 0),i([(0,c.ApiProperty)({description:"WhatsApp do usuário"}),(0,a.Prop)({required:!0,unique:!0}),(0,s.IsString)(),r("design:type",String)],d.prototype,"whatsapp",void 0),i([(0,c.ApiProperty)({description:"Status de verificação do email"}),(0,a.Prop)({default:!1}),(0,s.IsBoolean)(),r("design:type",Boolean)],d.prototype,"isEmailVerified",void 0),i([(0,c.ApiProperty)({description:"Status de ativação da conta"}),(0,a.Prop)({default:!0}),(0,s.IsBoolean)(),r("design:type",Boolean)],d.prototype,"isActive",void 0),i([(0,c.ApiProperty)({description:"Status de verificação"}),(0,a.Prop)({default:!1}),(0,s.IsBoolean)(),r("design:type",Boolean)],d.prototype,"isVerified",void 0),i([(0,c.ApiProperty)({description:"Código de ativação"}),(0,a.Prop)(),(0,s.IsString)(),(0,s.IsOptional)(),r("design:type",String)],d.prototype,"activationCode",void 0),i([(0,c.ApiProperty)({description:"Data de expiração do código de ativação"}),(0,a.Prop)(),(0,s.IsDate)(),(0,s.IsOptional)(),r("design:type",Date)],d.prototype,"activationCodeExpiresAt",void 0),i([(0,c.ApiProperty)({description:"Código de login"}),(0,a.Prop)(),(0,s.IsString)(),(0,s.IsOptional)(),r("design:type",String)],d.prototype,"loginCode",void 0),i([(0,c.ApiProperty)({description:"Data de expiração do código de login"}),(0,a.Prop)(),(0,s.IsDate)(),(0,s.IsOptional)(),r("design:type",Date)],d.prototype,"loginCodeExpiresAt",void 0),i([(0,c.ApiProperty)({description:"Data do último login"}),(0,a.Prop)(),(0,s.IsDate)(),(0,s.IsOptional)(),r("design:type",Date)],d.prototype,"lastLoginAt",void 0),t.User=d=i([(0,a.Schema)({timestamps:!0})],d),t.UserSchema=a.SchemaFactory.createForClass(d)},9520:e=>{e.exports=require("@nestjs/passport")},9556:e=>{e.exports=require("@nestjs/platform-express")},9557:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Name=void 0;const i=o(4977),r=o(63);class a extends i.ValueObject{constructor(e){super(e)}static create(e){if(!this.isValid(e))throw new r.InvalidNameError(e);return new a(this.normalize(e))}static isValid(e){return e.length>=3&&e.length<=100}static normalize(e){return e.trim().replace(/\s+/g," ")}getValue(){return this._value}equals(e){return this._value===e._value}toString(){return this._value}}t.Name=a},9598:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidEmailError=void 0;class o extends Error{constructor(e){super(`O email "${e}" é inválido`),this.name="InvalidEmailError"}}t.InvalidEmailError=o},9603:function(e,t,o){var i,r=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.JwtStrategy=void 0;const n=o(3563),s=o(9520),c=o(2714),d=o(3428),l=o(2649),p=process.env.JWT_SECRET||"gwan-secret-key-production-2024";let u=i=class extends((0,s.PassportStrategy)(c.Strategy)){constructor(e,t){super({jwtFromRequest:c.ExtractJwt.fromAuthHeaderAsBearerToken(),ignoreExpiration:!1,secretOrKey:p}),this.configService=e,this.userService=t,this.logger=new n.Logger(i.name),this.logger.log("[JWT] Estratégia JWT inicializada")}async validate(e){if(this.logger.debug("[JWT] Validando payload do token:",e),!e.sub||!e.email)throw this.logger.warn("[JWT] Payload inválido - campos obrigatórios ausentes"),new Error("Token inválido");const t=await this.userService.findById(e.sub);if(!t)throw this.logger.warn(`[JWT] Usuário não encontrado: ${e.sub}`),new Error("Usuário não encontrado");return this.logger.debug(`[JWT] Usuário validado: ${t.email}`),t}};t.JwtStrategy=u,t.JwtStrategy=u=i=r([(0,n.Injectable)(),a("design:paramtypes",[d.ConfigService,l.UserService])],u)},9609:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.USER_REPOSITORY=void 0,t.USER_REPOSITORY="USER_REPOSITORY"},9693:(e,t)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.KnowledgeBaseStatus=void 0,function(e){e.NEW="new",e.PROCESSING="processing",e.COMPLETED="completed",e.FAILED="failed"}(o||(t.KnowledgeBaseStatus=o={}))},9697:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.HealthController=void 0;const a=o(3563),n=o(9742);let s=class{check(){return{status:"healthy",timestamp:(new Date).toISOString(),service:"gwan-bff-app"}}};t.HealthController=s,i([(0,a.Get)(),(0,a.Head)(),(0,n.ApiOperation)({summary:"Health check endpoint"}),(0,n.ApiResponse)({status:200,description:"Service is healthy"}),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",void 0)],s.prototype,"check",null),t.HealthController=s=i([(0,n.ApiTags)("health"),(0,a.Controller)("health")],s)},9742:e=>{e.exports=require("@nestjs/swagger")},9762:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var r,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(n=(a<3?r(n):a>3?r(t,o,n):r(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.BucketFileSchema=t.BucketFile=t.FileStatus=void 0;const a=o(5839),n=o(6037),s=o(8205);Object.defineProperty(t,"FileStatus",{enumerable:!0,get:function(){return s.FileStatus}});let c=class extends n.Document{};t.BucketFile=c,i([(0,a.Prop)({type:n.Types.ObjectId,required:!0}),r("design:type",n.Types.ObjectId)],c.prototype,"userId",void 0),i([(0,a.Prop)({required:!0}),r("design:type",String)],c.prototype,"originalName",void 0),i([(0,a.Prop)({required:!0}),r("design:type",String)],c.prototype,"fileName",void 0),i([(0,a.Prop)({required:!0}),r("design:type",Number)],c.prototype,"size",void 0),i([(0,a.Prop)({required:!0}),r("design:type",String)],c.prototype,"mimeType",void 0),i([(0,a.Prop)({required:!0}),r("design:type",String)],c.prototype,"url",void 0),i([(0,a.Prop)({required:!0}),r("design:type",String)],c.prototype,"bucketName",void 0),i([(0,a.Prop)({type:n.Types.ObjectId}),r("design:type",n.Types.ObjectId)],c.prototype,"knowledgeBaseId",void 0),i([(0,a.Prop)({type:String,enum:s.FileStatus,default:s.FileStatus.AVAILABLE}),r("design:type",String)],c.prototype,"status",void 0),i([(0,a.Prop)(),r("design:type",String)],c.prototype,"processingError",void 0),i([(0,a.Prop)(),r("design:type",Date)],c.prototype,"lastModified",void 0),i([(0,a.Prop)(),r("design:type",Date)],c.prototype,"createdAt",void 0),i([(0,a.Prop)(),r("design:type",Date)],c.prototype,"updatedAt",void 0),t.BucketFile=c=i([(0,a.Schema)({timestamps:!0})],c),t.BucketFileSchema=a.SchemaFactory.createForClass(c)}},t={};function o(i){var r=t[i];if(void 0!==r)return r.exports;var a=t[i]={exports:{}};return e[i].call(a.exports,a,a.exports,o),a.exports}(()=>{const e=o(8781),t=o(9742),i=o(3563),r=o(3205),a=o(6037),n=o(3428),s=o(540),c=o(1697);process.on("unhandledRejection",((e,t)=>{console.error("Unhandled Rejection at:",t,"reason:",e)})),process.on("uncaughtException",(e=>{console.error("Uncaught Exception:",e),process.exit(1)})),async function(){const o=new i.Logger("Bootstrap");try{a.connection.on("connected",(async()=>{o.log("[MongoDB] Conexão estabelecida com sucesso");try{const e=a.connection.db,t=await e.command({connectionStatus:1});o.log("[MongoDB] Detalhes da conexão:",{database:e.databaseName,user:t?.authInfo?.authenticatedUsers?.[0]?.user||"não disponível",host:a.connection.host,port:a.connection.port,name:a.connection.name})}catch(e){o.error("[MongoDB] Erro ao obter status da conexão:",e)}})),a.connection.on("error",(e=>{o.error("[MongoDB] Erro na conexão:",e)})),a.connection.on("disconnected",(()=>{o.log("[MongoDB] Desconectado")}));const d=await e.NestFactory.create(r.AppModule),l=d.get(n.ConfigService);d.setGlobalPrefix("api"),d.enableCors(l.get("cors"));const p=l.get("swagger")||{title:"GWAN API",description:"API do sistema GWAN",version:"1.0"},u=(new t.DocumentBuilder).setTitle(p.title).setDescription(p.description).setVersion(p.version).addBearerAuth({type:"http",scheme:"bearer",bearerFormat:"JWT",name:"JWT",description:"Enter JWT token",in:"header"},"JWT").build(),g=t.SwaggerModule.createDocument(d,u);t.SwaggerModule.setup("api",d,g),d.useGlobalPipes(new i.ValidationPipe({whitelist:!0,transform:!0,forbidNonWhitelisted:!0})),d.useGlobalFilters(new s.HttpExceptionFilter),d.useGlobalInterceptors(new c.LoggingInterceptor);const f=l.get("port")||3e3;await d.listen(f),o.log(`Application is running on: http://localhost:${f}`),function(){const e=new i.Logger("Routes"),t="http://localhost:3000";e.log("\n=== Informações da API ==="),e.log(`Swagger: ${t}/api`),e.log(`API: ${t}`),e.log("\nRotas por domínio:"),e.log("\nAuth (/auth)"),e.log("POST /auth/register - Registro de usuário"),e.log("POST /auth/login - Login de usuário"),e.log("POST /auth/verify-code - Verificação de código"),e.log("POST /auth/verify-login-code - Verificação de código de login"),e.log("\nUser (/users)"),e.log("GET /users/profile - Obter perfil do usuário"),e.log("PUT /users/profile - Atualizar perfil do usuário"),e.log("\nKnowledge (/knowledge)"),e.log("GET /knowledge - Listar todo conhecimento"),e.log("GET /knowledge/:id - Buscar conhecimento por ID"),e.log("GET /knowledge/category/:category - Buscar por categoria"),e.log("GET /knowledge/author - Buscar por autor"),e.log("GET /knowledge/tags - Buscar por tags"),e.log("GET /knowledge/my - Buscar conhecimento do usuário atual"),e.log("POST /knowledge - Criar conhecimento"),e.log("PUT /knowledge/:id - Atualizar conhecimento"),e.log("\nDataset (/user/dataset)"),e.log("POST /user/dataset - Upload de dataset"),e.log("GET /user/dataset - Listar datasets"),e.log("GET /user/dataset/:id - Buscar dataset por ID"),e.log("\nHealth (/health)"),e.log("GET /health - Verificação de saúde da aplicação"),e.log("\nObservações:"),e.log("- Todas as rotas (exceto /auth/* e /health) requerem autenticação JWT"),e.log("- A documentação completa está disponível no Swagger UI"),e.log("- As rotas estão organizadas por domínio seguindo princípios de Clean Architecture"),e.log("- Cada rota possui validação de DTOs e tratamento de erros"),e.log("- As respostas são padronizadas e documentadas com Swagger\n")}()}catch(e){o.error("Erro ao iniciar a aplicação:",e),process.exit(1)}}()})()})();