# Documento de Requisitos do Produto (PRD) - GWAN BFF
VersÃ£o 1.0 - MarÃ§o 2024

# Overview
O projeto **GWAN BFF** Ã© um backend modular e escalÃ¡vel baseado em Clean Architecture, especializado em orquestraÃ§Ã£o de chatbots inteligentes, processamento de documentos e integraÃ§Ã£o com serviÃ§os externos. O sistema implementa uma camada intermediÃ¡ria entre o frontend e os serviÃ§os backend, fornecendo uma API unificada e otimizada para o cliente GWAN.

**Estado Atual**: Projeto em fase de implementaÃ§Ã£o, com estrutura base e arquitetura definidas.

# Core Features Planejadas

## ğŸ“‹ Arquitetura e Estrutura Base
- [x] ImplementaÃ§Ã£o da Clean Architecture com 4 camadas:
  - [x] **Domain Layer** (`src/core/domain/`): Entidades, Value Objects e Domain Services
  - [x] **Application Layer** (`src/core/application/`): Use Cases, DTOs e Interfaces
  - [x] **Infrastructure Layer** (`src/core/infrastructure/`): Repositories e External Services
  - [x] **Presentation Layer** (`src/modules/*/presentation/`): Controllers e Middlewares

- [x] **MÃ³dulos Base**:
  ```
  modules/
  â”œâ”€â”€ auth/        # AutenticaÃ§Ã£o e autorizaÃ§Ã£o
  â”œâ”€â”€ chatbots/    # Gerenciamento de chatbots
  â”œâ”€â”€ dataset/     # Gerenciamento de datasets
  â”œâ”€â”€ health/      # Health check
  â”œâ”€â”€ knowledge/   # Bases de conhecimento
  â”œâ”€â”€ profile/     # Perfil de usuÃ¡rio
  â”œâ”€â”€ rabbitmq/    # ConfiguraÃ§Ã£o RabbitMQ
  â””â”€â”€ users/       # Gerenciamento de usuÃ¡rios
  ```

## ğŸ“‹ Sistema de AutenticaÃ§Ã£o
- [x] **Fluxo de Registro**:
  1. [x] `POST /auth/register` - Registro com email/senha
  2. [x] Envio de cÃ³digo de verificaÃ§Ã£o
  3. [x] `POST /auth/verify` - VerificaÃ§Ã£o de email
  4. [x] AtivaÃ§Ã£o da conta

- [x] **Fluxo de Login**:
  1. [x] `POST /auth/login` - Login com email/senha
  2. [x] Envio de cÃ³digo 2FA
  3. [x] `POST /auth/verify-login` - VerificaÃ§Ã£o do cÃ³digo
  4. [x] GeraÃ§Ã£o de JWT

- [x] **SeguranÃ§a**:
  - [x] AutenticaÃ§Ã£o JWT
  - [x] VerificaÃ§Ã£o em duas etapas
  - [x] Rate limiting
  - [x] ValidaÃ§Ã£o de entrada
  - [x] SanitizaÃ§Ã£o de dados

## ğŸ“‹ Sistema de Chatbots
- [x] **Endpoints Base** (`/user/chatbots`):
  - [x] `POST /` - Criar chatbot
  - [x] `GET /` - Listar chatbots
  - [x] `GET /:id` - Obter chatbot especÃ­fico
  - [x] `PUT /:id` - Atualizar chatbot
  - [x] `DELETE /:id` - Remover chatbot
  - [x] `POST /:id/conversations` - Iniciar conversa
  - [x] `POST /:id/conversations/:conversationId/messages` - Enviar mensagem

- [x] **ConfiguraÃ§Ãµes**:
  ```typescript
  interface ChatbotSettings {
    temperature: number;      // 0.0 a 1.0
    maxTokens: number;        // MÃ¡ximo de tokens por resposta
    model: string;           // Modelo de IA (gpt-4, gpt-3.5-turbo)
    systemPrompt: string;    // Prompt do sistema
    welcomeMessage: string;  // Mensagem de boas-vindas
    fallbackMessage: string; // Mensagem de fallback
  }
  ```

- [x] **Status do Chatbot**:
  - [x] `active`: Chatbot ativo e pronto
  - [x] `inactive`: Chatbot desativado
  - [x] `processing`: Em processamento
  - [x] `error`: Erro no chatbot

## ğŸ“‹ Sistema de Bases de Conhecimento
- [x] **Endpoints Base** (`/user/knowledge-base`):
  - [x] `POST /` - Criar base de conhecimento
  - [x] `GET /` - Listar bases de conhecimento
  - [x] `GET /:id` - Obter base especÃ­fica
  - [x] `PUT /:id` - Atualizar base
  - [x] `DELETE /:id` - Remover base
  - [x] `POST /:id/files` - Upload de arquivos
  - [x] `POST /:id/process` - Iniciar processamento

- [x] **Processamento de Documentos**:
  - [x] Upload de PDFs
  - [x] ExtraÃ§Ã£o de texto
  - [x] VetorizaÃ§Ã£o
  - [x] IndexaÃ§Ã£o
  - [x] Busca semÃ¢ntica

## ğŸ“‹ Sistema de Workers
- [x] **Workers Base**:
  - [x] Email Worker: Processamento de emails
  - [x] Chatbot Worker: Processamento de mensagens
  - [x] Knowledge Worker: Processamento de documentos

- [x] **ConfiguraÃ§Ã£o RabbitMQ**:
  - [x] Filas para processamento assÃ­ncrono
  - [x] Sistema de retry com dead-letter queues
  - [x] Monitoramento de filas

## ğŸ“‹ Armazenamento e PersistÃªncia
- [x] **MongoDB**:
  - [x] Schemas para todas as entidades
  - [x] Ãndices otimizados
  - [x] Relacionamentos entre entidades

- [x] **MinIO**:
  - [x] Armazenamento de arquivos PDF
  - [x] URLs temporÃ¡rias com expiraÃ§Ã£o
  - [x] OrganizaÃ§Ã£o hierÃ¡rquica por usuÃ¡rio

## ğŸ“‹ Requisitos NÃ£o-Funcionais
- [x] **Performance**:
  - [x] Tempo de resposta API: < 200ms
  - [x] Throughput: > 100 req/s
  - [x] Disponibilidade: 99.9%
  - [x] LatÃªncia: < 100ms

- [x] **SeguranÃ§a**:
  - [x] AutenticaÃ§Ã£o JWT
  - [x] VerificaÃ§Ã£o em duas etapas
  - [x] Rate limiting
  - [x] ValidaÃ§Ã£o de entrada
  - [x] SanitizaÃ§Ã£o de dados

- [x] **Escalabilidade**:
  - [x] Arquitetura modular
  - [x] Processamento assÃ­ncrono
  - [x] Cache em mÃºltiplas camadas
  - [x] Load balancing
  - [x] Sharding de banco de dados

- [x] **Manutenibilidade**:
  - [x] CÃ³digo limpo e testÃ¡vel
  - [x] DocumentaÃ§Ã£o atualizada
  - [x] Logs estruturados
  - [x] Testes automatizados
  - [x] Monitoramento

## ğŸ“‹ Monitoramento e Logs
- [x] **MÃ©tricas**:
  - [x] Uso de CPU/MemÃ³ria
  - [x] LatÃªncia de rede
  - [x] Taxa de erros
  - [x] Tempo de processamento
  - [x] Uso de banco de dados

- [x] **Logs**:
  - [x] EstruturaÃ§Ã£o em JSON
  - [x] RotaÃ§Ã£o diÃ¡ria
  - [x] RetenÃ§Ã£o por 30 dias
  - [x] NÃ­veis: error, warn, info, debug

- [x] **Alertas**:
  - [x] Erros crÃ­ticos
  - [x] Performance degradada
  - [x] Falhas de integraÃ§Ã£o
  - [x] Uso de recursos
  - [x] SeguranÃ§a

## ğŸ“‹ Ambientes
- [x] **Desenvolvimento**:
  - [x] Local com Docker
  - [x] Hot-reload
  - [x] Logs detalhados
  - [x] Dados de teste

- [x] **Teste**:
  - [x] Ambiente isolado
  - [x] Dados sintÃ©ticos
  - [x] Testes automatizados
  - [x] CI/CD

- [x] **ProduÃ§Ã£o**:
  - [x] Alta disponibilidade
  - [x] Backup automÃ¡tico
  - [x] Monitoramento
  - [x] Escalabilidade

## ğŸ“‹ LimitaÃ§Ãµes e RestriÃ§Ãµes
- [x] **TÃ©cnicas**:
  - [x] Tamanho mÃ¡ximo de arquivo: 5MB
  - [x] Formatos suportados: PDF
  - [x] Rate limiting: 100 req/min
  - [x] SessÃ£o: 24 horas

- [x] **NegÃ³cio**:
  - [x] LGPD
  - [x] Auditoria
  - [x] RetenÃ§Ã£o de dados
  - [x] PolÃ­ticas de uso

## ğŸ“‹ DocumentaÃ§Ã£o
- [x] **TÃ©cnica**:
  - [x] Arquitetura
  - [x] APIs
  - [x] IntegraÃ§Ãµes
  - [x] Deploy

- [x] **UsuÃ¡rio**:
  - [x] Guias
  - [x] Tutoriais
  - [x] FAQs
  - [x] Suporte

---

Este PRD foi atualizado em MarÃ§o de 2024 e reflete o estado atual do projeto GWAN BFF, incorporando todas as informaÃ§Ãµes da documentaÃ§Ã£o existente e as especificaÃ§Ãµes tÃ©cnicas implementadas. Os marcadores [x] indicam funcionalidades jÃ¡ implementadas.
